<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ì£¼ë¬¸ ê²°ì œ - í™€ë¦¬ë°¤</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kit.fontawesome.com/69077b3f9d.js" crossorigin="anonymous"></script>
    <link th:href="@{/css/header.css}" rel="stylesheet"/>
    <link th:href="@{/css/footer.css}" rel="stylesheet"/>
    <script type="text/javascript" th:src="@{/js/header.js}"></script>
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            line-height: 1.6;
            color: #333;
            padding-top: 80px;
        }

        .main-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: calc(100vh - 200px);
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: #EE386D;
            border-radius: 2px;
        }

        /* ì²´í¬ì•„ì›ƒ ë ˆì´ì•„ì›ƒ */
        .checkout-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 60px;
            align-items: start;
        }

        /* ì™¼ìª½ ì£¼ë¬¸ì ì •ë³´ */
        .order-form {
            background: #ffffff;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f8f9fa;
            position: relative;
        }

        .section-title::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 30px;
            height: 2px;
            background: #EE386D;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: '*';
            color: #EE386D;
            margin-left: 4px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #EE386D;
            box-shadow: 0 0 0 3px rgba(238, 56, 109, 0.1);
        }

        .form-input.error, .form-select.error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .form-input:disabled, .form-select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }

        .form-input.readonly-field {
            background-color: #f8f9fa;
            color: #495057;
            border-color: #ced4da;
            cursor: default;
        }

        .btn-search.disabled-button {
            background-color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-search.disabled-button:hover {
            background-color: #6c757d;
            transform: none;
        }

        .form-input::placeholder {
            color: #999;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group .form-input {
            flex: 1;
        }

        .btn-search, .btn-apply {
            background: #EE386D;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-search:hover, .btn-apply:hover {
            background: #d63060;
            transform: translateY(-1px);
        }

        .btn-apply:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .form-select.disabled-coupon {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }

        .form-input.disabled-input {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }

        .btn-apply.disabled-button {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-apply.disabled-button:hover {
            background: #6c757d;
            transform: none;
        }

        /* ë¡œë”© ìƒíƒœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-apply.loading {
            background: #6c757d !important;
            cursor: not-allowed !important;
            transform: none !important;
            pointer-events: none;
        }

        .btn-apply.loading .btn-text {
            display: none;
        }

        .btn-apply.loading .btn-loading {
            display: inline-block;
        }

        .btn-loading {
            display: none;
        }

        /* ì¿ í° ë° í• ì¸ ì½”ë“œ ì„¹ì…˜ */
        .discount-section {
            border: 2px dashed #EE386D;
            border-radius: 16px;
            padding: 24px;
            background: linear-gradient(135deg, #fff8fa 0%, #fff 100%);
            margin-bottom: 20px;
        }

        .discount-section .section-title {
            border-bottom: none;
            margin-bottom: 20px;
            color: #EE386D;
        }

        .discount-section .section-title::before {
            display: none;
        }

        .discount-section .section-title::after {
            content: 'ğŸ’¸';
            margin-left: 8px;
        }

        .discount-notice {
            font-size: 12px;
            color: #666;
            background: rgba(238, 56, 109, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid rgba(238, 56, 109, 0.2);
            white-space: nowrap;
        }

        .coupon-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }

        .coupon-info.active {
            color: #EE386D;
            font-weight: 500;
        }

        .discount-code-group {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .discount-code-group .form-input {
            flex: 1;
        }

        .discount-applied {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            color: #0369a1;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .discount-applied .remove-discount {
            background: none;
            border: none;
            color: #0369a1;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .discount-applied .remove-discount:hover {
            background: rgba(3, 105, 161, 0.1);
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .error-message {
            background: #fff2f2;
            border: 1px solid #ffcccc;
            color: #d63060;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .field-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        /* ì‚¬ìš©ì ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ê²°ì œ ë²„íŠ¼ ë¡œë”© ìƒíƒœ */
        .checkout-button.processing {
            background: #6c757d !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }

        .checkout-button.processing:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-input {
            width: 18px;
            height: 18px;
            accent-color: #EE386D;
        }

        .checkbox-label {
            font-size: 14px;
            color: #666;
            cursor: pointer;
        }

        /* ê²°ì œ ë°©ë²• */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
        }

        .payment-method:hover {
            border-color: #EE386D;
            background: #fff8fa;
        }

        .payment-method.active {
            border-color: #EE386D;
            background: #fff8fa;
        }

        .payment-method input[type="radio"] {
            margin-right: 10px;
            accent-color: #EE386D;
        }

        .payment-method label {
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        /* ì˜¤ë¥¸ìª½ ì£¼ë¬¸ ì •ë³´ (sticky) */
        .order-summary {
            position: sticky;
            top: 120px;
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
            text-align: center;
        }

        .product-item {
            display: flex;
            gap: 15px;
            padding: 20px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            background: #f8f9fa;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .product-options {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .product-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-quantity {
            font-size: 12px;
            color: #666;
        }

        .product-amount {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        /* ê°€ê²© ì •ë³´ */
        .price-breakdown {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .price-row:last-child {
            margin-bottom: 0;
        }

        .price-label {
            font-size: 14px;
            color: #666;
        }

        .price-value {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .price-value.discount {
            color: #EE386D;
        }

        .total-row {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .total-row .price-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .total-row .price-value {
            font-size: 18px;
            font-weight: 700;
            color: #EE386D;
        }

        /* ê²°ì œ ë²„íŠ¼ */
        .checkout-button {
            width: 100%;
            background: linear-gradient(135deg, #EE386D 0%, #d63060 100%) !important;
            color: white !important;
            border: none !important;
            padding: 18px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer !important;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(238, 56, 109, 0.3) !important;
            pointer-events: auto !important;
        }

        .checkout-button:hover:not(:disabled):not(.processing):not(.disabled) {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(238, 56, 109, 0.4) !important;
        }

        .checkout-button:active:not(:disabled):not(.processing):not(.disabled) {
            transform: translateY(0) !important;
        }

        .checkout-button:disabled,
        .checkout-button.disabled {
            background: #ccc !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
            color: white !important;
            pointer-events: auto !important;
        }

        .checkout-button.processing {
            background: #6c757d !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
            color: white !important;
            pointer-events: none !important;
        }

        /* ê°•ì œ ë³µì›ìš© ìŠ¤íƒ€ì¼ */
        .checkout-button.force-active {
            background: linear-gradient(135deg, #EE386D 0%, #d63060 100%) !important;
            color: white !important;
            cursor: pointer !important;
            transform: none !important;
            box-shadow: 0 4px 12px rgba(238, 56, 109, 0.3) !important;
            pointer-events: auto !important;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1024px) {
            .checkout-layout {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .order-summary {
                position: static;
                order: -1;
            }

            .main-container {
                padding: 30px 20px;
            }

            .order-form {
                padding: 30px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 20px 16px;
            }

            .order-form {
                padding: 24px;
                border-radius: 16px;
            }

            .order-summary {
                padding: 24px;
                border-radius: 16px;
            }

            .payment-methods {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 24px;
                margin-bottom: 30px;
            }

            .discount-code-group {
                flex-direction: column;
            }

            .discount-code-group .btn-apply {
                width: 100%;
            }

            .discount-notice {
                font-size: 11px;
                padding: 3px 6px;
            }

            .discount-section > div:first-child {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 8px;
            }

            .discount-section .section-title {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .input-group {
                flex-direction: column;
            }

            .btn-search {
                width: 100%;
            }

            .product-item {
                gap: 12px;
            }

            .product-image {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
<!-- ê³ ì • í—¤ë” -->
<div th:replace="~{layout/header :: header}"></div>

<!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
<div class="main-container">
    <h1 class="page-title">ì£¼ë¬¸ ê²°ì œ</h1>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ -->
    <div th:if="${error}" class="error-message" th:text="${error}"></div>

    <div class="checkout-layout">
        <!-- ì™¼ìª½: ì£¼ë¬¸ì ì •ë³´ -->
        <form id="paymentForm" class="order-form">
            <!-- ì£¼ë¬¸ì ì •ë³´ -->
            <div class="form-section">
                <h2 class="section-title">ì£¼ë¬¸ì ì •ë³´</h2>
                <div class="form-group">
                    <label class="form-label required">ì´ë¦„</label>
                    <input type="text" id="ordererName" class="form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                           th:value="${member != null} ? ${member.memberName} : ''" required>
                    <div class="field-error" id="ordererName-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label required">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="tel" id="ordererPhone" class="form-input" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (010-1234-5678)"
                           th:value="${member != null} ? ${member.memberPhone} : ''" required>
                    <div class="field-error" id="ordererPhone-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label required">ì´ë©”ì¼</label>
                    <input type="email" id="ordererEmail" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                           th:value="${member != null} ? ${member.memberMail} : ''" required>
                    <div class="field-error" id="ordererEmail-error"></div>
                </div>
            </div>

            <!-- ì¿ í° ë° í• ì¸ ì½”ë“œ ì„¹ì…˜ -->
            <div class="form-section">
                <div class="discount-section">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                        <h2 class="section-title" style="margin-bottom: 0;">ì¿ í° & í• ì¸ì½”ë“œ</h2>
                        <span class="discount-notice">ì¿ í°ê³¼ í• ì¸ì½”ë“œëŠ” ì¤‘ë³µ ì‚¬ìš© ë¶ˆê°€</span>
                    </div>

                    <!-- ì¿ í° ì„ íƒ -->
                    <div class="form-group">
                        <label class="form-label">ë³´ìœ  ì¿ í°</label>
                        <select id="couponSelect" class="form-select" th:disabled="${#lists.isEmpty(couponList)}">
                            <option value="" th:if="${!#lists.isEmpty(couponList)}">ì¿ í°ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                            <option value="" th:if="${#lists.isEmpty(couponList)}" disabled>ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤</option>

                            <!-- DBì—ì„œ ê°€ì ¸ì˜¨ ì¿ í° ë¦¬ìŠ¤íŠ¸ í‘œì‹œ -->
                            <option th:each="coupon : ${couponList}"
                                    th:value="${coupon.couponId}"
                                    th:data-type="${coupon.discountType}"
                                    th:data-value="${coupon.discountValue}"
                                    th:data-min-amount="${coupon.minOrderPrice}"
                                    th:text="${coupon.couponName} + ' (' + ${#numbers.formatInteger(coupon.minOrderPrice, 0, 'COMMA')} + 'ì› ì´ìƒ)'">
                            </option>
                        </select>
                        <div class="coupon-info" id="couponInfo">
                            <i class="fas fa-info-circle"></i>
                            <span th:if="${!#lists.isEmpty(couponList)}">ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì„ ì„ íƒí•˜ë©´ í• ì¸ì´ ì ìš©ë©ë‹ˆë‹¤</span>
                            <span th:if="${#lists.isEmpty(couponList)}" style="color: #999;">í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤</span>
                        </div>
                    </div>

                    <!-- í• ì¸ ì½”ë“œ ì…ë ¥ -->
                    <div class="form-group">
                        <label class="form-label">í• ì¸ì½”ë“œ</label>
                        <div class="discount-code-group">
                            <input type="text" id="discountCode" class="form-input" placeholder="í• ì¸ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" maxlength="20">
                            <button type="button" class="btn-apply" id="applyDiscountCode">
                                <span class="btn-text">ì ìš©</span>
                                <span class="btn-loading">
                                    <i class="fas fa-spinner fa-spin"></i> í™•ì¸ì¤‘
                                </span>
                            </button>
                        </div>
                        <div class="coupon-info">
                            <i class="fas fa-gift"></i>
                            <span>í• ì¸ì½”ë“œëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤</span>
                        </div>
                    </div>

                    <!-- ì ìš©ëœ í• ì¸ í‘œì‹œ -->
                    <div id="appliedDiscount" class="discount-applied" style="display: none;">
                        <div>
                            <i class="fas fa-check-circle"></i>
                            <span id="discountText">í• ì¸ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤</span>
                        </div>
                        <button type="button" class="remove-discount" onclick="removeDiscount()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë°°ì†¡ ì •ë³´ -->
            <div class="form-section">
                <h2 class="section-title">ë°°ì†¡ ì •ë³´</h2>
                <div class="checkbox-group">
                    <input type="checkbox" id="same-info" class="checkbox-input"
                           th:checked="${member != null}">
                    <label for="same-info" class="checkbox-label">ì£¼ë¬¸ì ì •ë³´ì™€ ë™ì¼</label>
                </div>
                <div class="form-group">
                    <label class="form-label required">ë°›ëŠ” ë¶„</label>
                    <input type="text" id="receiverName" class="form-input" placeholder="ë°›ëŠ” ë¶„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                           th:value="${member != null} ? ${member.memberName} : ''" required>
                    <div class="field-error" id="receiverName-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label required">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="tel" id="receiverPhone" class="form-input" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (010-1234-5678)"
                           th:value="${member != null} ? ${member.memberPhone} : ''" required>
                    <div class="field-error" id="receiverPhone-error"></div>
                </div>

                <!-- ì£¼ì†Œ ì…ë ¥ í•„ë“œë“¤ -->
                <div class="address-fields" id="addressFields">
                    <div class="form-group">
                        <label class="form-label required">ì£¼ì†Œ</label>
                        <div class="input-group">
                            <input type="text" id="receiverZip" class="form-input" placeholder="ìš°í¸ë²ˆí˜¸"
                                   th:value="${member != null} ? ${member.memberZip} : ''"
                                   th:data-member-zip="${member != null} ? ${member.memberZip} : ''"
                                   required readonly>
                            <button type="button" class="btn-search" onclick="execDaumPostcode()">ì£¼ì†Œ ê²€ìƒ‰</button>
                        </div>
                        <input type="text" id="receiverAddr" class="form-input" placeholder="ê¸°ë³¸ ì£¼ì†Œ"
                               th:value="${member != null} ? ${member.memberAddr} : ''"
                               th:data-member-addr="${member != null} ? ${member.memberAddr} : ''"
                               style="margin-top: 10px;" required readonly>
                        <input type="text" id="receiverAddrDetail" class="form-input" placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                               style="margin-top: 10px;" required>
                        <div class="field-error" id="receiverAddr-error"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë°°ì†¡ ìš”ì²­ì‚¬í•­</label>
                        <input type="text" id="deliveryRequest" class="form-input" placeholder="ë°°ì†¡ ì‹œ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì„ íƒ)">
                    </div>
                </div>
            </div>

            <!-- ê²°ì œ ë°©ë²• -->
            <div class="form-section">
                <h2 class="section-title">ê²°ì œ ë°©ë²•</h2>
                <div class="payment-methods">
                    <div class="payment-method active">
                        <input type="radio" id="card" name="payment" value="card" checked>
                        <label for="card">ì‹ ìš©ì¹´ë“œ</label>
                    </div>
                    <div class="payment-method">
                        <input type="radio" id="trans" name="payment" value="trans">
                        <label for="trans">ì‹¤ì‹œê°„ê³„ì¢Œì´ì²´</label>
                    </div>
                    <div class="payment-method">
                        <input type="radio" id="vbank" name="payment" value="vbank">
                        <label for="vbank">ê°€ìƒê³„ì¢Œ</label>
                    </div>
                    <div class="payment-method">
                        <input type="radio" id="phone" name="payment" value="phone">
                        <label for="phone">íœ´ëŒ€í° ì†Œì•¡ê²°ì œ</label>
                    </div>
                </div>
            </div>

            <!-- ë™ì˜ ì‚¬í•­ -->
            <div class="form-section">
                <h2 class="section-title">ì£¼ë¬¸ ë™ì˜</h2>
                <div class="checkbox-group">
                    <input type="checkbox" id="agree-all" class="checkbox-input">
                    <label for="agree-all" class="checkbox-label">ì „ì²´ ë™ì˜</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="agree-terms" class="checkbox-input" required>
                    <label for="agree-terms" class="checkbox-label">êµ¬ë§¤ì¡°ê±´ ë° ê²°ì œì§„í–‰ ë™ì˜ (í•„ìˆ˜)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="agree-privacy" class="checkbox-input" required>
                    <label for="agree-privacy" class="checkbox-label">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="agree-adult" class="checkbox-input" required>
                    <label for="agree-adult" class="checkbox-label">ì„±ì¸ìš©í’ˆ êµ¬ë§¤ ë™ì˜ ë° ì„±ì¸ì¸ì¦ í™•ì¸ (í•„ìˆ˜)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="agree-marketing" class="checkbox-input">
                    <label for="agree-marketing" class="checkbox-label">ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì„ íƒ)</label>
                </div>
            </div>
        </form>

        <!-- ì˜¤ë¥¸ìª½: ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ -->
        <div class="order-summary">
            <h2 class="summary-title">ì£¼ë¬¸ ìƒí’ˆ</h2>

            <!-- ìƒí’ˆ ëª©ë¡ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¡œ í‘œì‹œ) -->
            <div id="productList">
                <!-- Thymeleafë¡œ ìƒí’ˆ ëª©ë¡ í‘œì‹œ -->
                <div th:each="item : ${cartItems}" class="product-item">
                    <img th:src="${item.imageDto != null && item.imageDto.imageUrl != null} ? ('/testImage/' + ${item.imageDto.imageUrl}) : 'https://via.placeholder.com/80x80/f0f0f0/999?text=Product'"
                         alt="ìƒí’ˆ ì´ë¯¸ì§€" class="product-image">
                    <div class="product-info">
                        <div class="product-name" th:text="${item.productDto.productName}">ìƒí’ˆëª…</div>
                        <div class="product-options" th:if="${item.productOptionDto != null}">
                            <span th:text="${item.productOptionDto.optionName}">ì˜µì…˜ëª…</span>:
                            <span th:text="${item.productOptionDto.optionValue}">ì˜µì…˜ê°’</span>
                        </div>
                        <div class="product-price">
                            <span class="product-quantity" th:text="'ìˆ˜ëŸ‰ ' + ${item.quantity} + 'ê°œ'">ìˆ˜ëŸ‰ 1ê°œ</span>
                            <span class="product-amount" th:text="'â‚©' + ${#numbers.formatInteger((item.priceDto.priceSelling + (item.productOptionDto != null ? item.productOptionDto.optionPrice : 0)) * item.quantity, 0, 'COMMA')}">â‚©150,000</span>
                        </div>
                    </div>
                </div>

                <!-- ìƒí’ˆì´ ì—†ì„ ë•Œ í‘œì‹œ -->
                <div th:if="${#lists.isEmpty(cartItems)}" class="product-item">
                    <div class="product-info" style="text-align: center; width: 100%;">
                        <div class="product-name">ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>

            <div class="price-breakdown">
                <div class="price-row">
                    <span class="price-label">ìƒí’ˆ ê¸ˆì•¡</span>
                    <span class="price-value" id="originalAmount" th:text="'â‚©' + ${#numbers.formatInteger(paymentInfo.totalAmount, 0, 'COMMA')}">â‚©0</span>
                </div>
                <div class="price-row" id="discountRow" style="display: none;">
                    <span class="price-label" id="discountLabel">í• ì¸</span>
                    <span class="price-value discount" id="discountAmount">-â‚©0</span>
                </div>
                <div class="price-row">
                    <span class="price-label">ê¸°ë³¸ í• ì¸</span>
                    <span class="price-value" th:text="'-â‚©' + ${#numbers.formatInteger(paymentInfo.discountAmount, 0, 'COMMA')}">â‚©0</span>
                </div>
                <div class="price-row">
                    <span class="price-label">ë°°ì†¡ë¹„</span>
                    <span class="price-value" th:text="${paymentInfo.deliveryFee == 0} ? 'ë¬´ë£Œ' : 'â‚©' + ${#numbers.formatInteger(paymentInfo.deliveryFee, 0, 'COMMA')}">â‚©0</span>
                </div>
                <div class="price-row total-row">
                    <span class="price-label">ì´ ê²°ì œ ê¸ˆì•¡</span>
                    <span class="price-value" id="finalAmount" th:text="'â‚©' + ${#numbers.formatInteger(paymentInfo.finalAmount, 0, 'COMMA')}">â‚©0</span>
                </div>
            </div>

            <button type="button" class="checkout-button" id="paymentButton">
                <i class="fas fa-lock" style="margin-right: 8px;"></i>
                <span id="paymentButtonText" th:text="'â‚©' + ${#numbers.formatInteger(paymentInfo.finalAmount, 0, 'COMMA')} + ' ê²°ì œí•˜ê¸°'">â‚©0 ê²°ì œí•˜ê¸°</span>
            </button>
        </div>
    </div>
</div>

<!-- ê³ ì • í’‹í„° -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<script th:inline="javascript">
    // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
    const paymentInfo = /*[[${paymentInfo}]]*/ {};
    const cartCodes = /*[[${cartCodes}]]*/ [];
    const cartItems = /*[[${cartItems}]]*/ [];

    // íšŒì› ì •ë³´ (Thymeleafì—ì„œ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ)
    const memberInfo = {
        memberZip: /*[[${member != null ? member.memberZip : ''}]]*/ '',
        memberAddr: /*[[${member != null ? member.memberAddr : ''}]]*/ ''
    };

    // í• ì¸ ê´€ë ¨ ë³€ìˆ˜ (ë‹¨ë… ì‚¬ìš©)
    let activeDiscount = null; // í˜„ì¬ í™œì„±í™”ëœ í• ì¸ (ì¿ í° ë˜ëŠ” í• ì¸ì½”ë“œ)
    let originalAmount = paymentInfo.totalAmount || 0;
    let currentTotalAmount = paymentInfo.finalAmount || 0;

    // ì•„ì„í¬íŠ¸ ì´ˆê¸°í™”
    window.IMP.init("imp03183375");

    // ìœ íš¨ì„± ê²€ì‚¬ ìƒíƒœ ì¶”ì 
    const validationState = {
        ordererName: false,
        ordererPhone: false,
        ordererEmail: false,
        receiverName: false,
        receiverPhone: false,
        receiverAddr: false,
        agreeTerms: false,
        agreePrivacy: false,
        agreeAdult: false
    };

    $(document).ready(function() {
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        setupEventListeners();

        // ì´ˆê¸° ìœ íš¨ì„± ê²€ì‚¬
        validateAllFields();

        // ì´ˆê¸° ì£¼ì†Œ í•„ë“œ ìƒíƒœ ì„¤ì •
        updateAddressFields();

        console.log("Payment Info:", paymentInfo);
        console.log("Cart Items:", cartItems);
    });

    function setupEventListeners() {
        // ê²°ì œ ë°©ë²• ì„ íƒ
        $('.payment-method').click(function() {
            $('.payment-method').removeClass('active');
            $(this).addClass('active');
            $(this).find('input[type="radio"]').prop('checked', true);
        });

        // ì£¼ë¬¸ì ì •ë³´ì™€ ë™ì¼ ì²´í¬ë°•ìŠ¤
        $('#same-info').change(function() {
            updateAddressFields();
            if ($(this).is(':checked')) {
                $('#receiverName').val($('#ordererName').val());
                $('#receiverPhone').val($('#ordererPhone').val());
                validateField('receiverName');
                validateField('receiverPhone');
            } else {
                $('#receiverName').val('');
                $('#receiverPhone').val('');
                $('#receiverZip').val('');
                $('#receiverAddr').val('');
                $('#receiverAddrDetail').val('');
                $('#deliveryRequest').val('');
                clearFieldError('receiverName');
                clearFieldError('receiverPhone');
                clearFieldError('receiverAddr');
                validationState.receiverName = false;
                validationState.receiverPhone = false;
                validationState.receiverAddr = false;
            }
            updatePaymentButton();
        });

        // ì¿ í° ì„ íƒ
        $('#couponSelect').change(function() {
            if ($(this).prop('disabled')) {
                return;
            }

            const selectedOption = $(this).find('option:selected');
            applyCoupon(selectedOption);
        });

        // í• ì¸ì½”ë“œ ì ìš©
        $('#applyDiscountCode').click(function() {
            if ($(this).prop('disabled') || $(this).hasClass('loading')) {
                return;
            }

            const code = $('#discountCode').val().trim();
            if (code) {
                applyDiscountCode(code);
            } else {
                showUserMessage('í• ì¸ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            }
        });

        // í• ì¸ì½”ë“œ ì…ë ¥ ì‹œ ì—”í„°í‚¤ ì²˜ë¦¬
        $('#discountCode').keypress(function(e) {
            if (e.which === 13 && !$(this).prop('disabled') && !$('#applyDiscountCode').hasClass('loading')) {
                $('#applyDiscountCode').click();
            }
        });

        // ì „ì²´ ë™ì˜ ì²´í¬ë°•ìŠ¤
        $('#agree-all').change(function() {
            const isChecked = $(this).is(':checked');
            $('input[id^="agree-"]').not('#agree-all').prop('checked', isChecked);
            validateAgreements();
        });

        // ê°œë³„ ë™ì˜ ì²´í¬ë°•ìŠ¤
        $('input[id^="agree-"]').not('#agree-all').change(function() {
            const totalCheckboxes = $('input[id^="agree-"]').not('#agree-all').length;
            const checkedCheckboxes = $('input[id^="agree-"]:checked').not('#agree-all').length;
            $('#agree-all').prop('checked', totalCheckboxes === checkedCheckboxes);
            validateAgreements();
        });

        // ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
        $('#ordererName, #receiverName').on('input', function() {
            validateField(this.id);
        });

        $('#ordererPhone, #receiverPhone').on('input', function() {
            const value = $(this).val().replace(/[^0-9]/g, '');
            if (value.length <= 11) {
                let formatted = value;
                if (value.length > 6) {
                    formatted = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
                } else if (value.length > 3) {
                    formatted = value.slice(0, 3) + '-' + value.slice(3);
                }
                $(this).val(formatted);
            }
            validateField(this.id);
        });

        $('#ordererEmail').on('input', function() {
            validateField(this.id);
        });

        $('#receiverAddrDetail').on('input', function() {
            validateField('receiverAddr');
        });

        // ê²°ì œ ë²„íŠ¼ í´ë¦­
        $('#paymentButton').click(function() {
            if (isFormValid()) {
                processPayment();
            } else {
                const firstErrorField = Object.keys(validationState).find(key => !validationState[key]);
                if (firstErrorField && firstErrorField !== 'agreeTerms' && firstErrorField !== 'agreePrivacy' && firstErrorField !== 'agreeAdult') {
                    $('#' + firstErrorField).focus();
                }
            }
        });
    }

    // í• ì¸ì½”ë“œ ì ìš© (ë°±ì—”ë“œ ê²€ì¦)
    function applyDiscountCode(code) {
        // ì¿ í°ì´ ì´ë¯¸ ì ìš©ëœ ê²½ìš° ê²½ê³ 
        if (activeDiscount && activeDiscount.type === 'coupon') {
            showUserMessage('ì¿ í°ì´ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¿ í°ì„ í•´ì œí•˜ê³  í• ì¸ì½”ë“œë¥¼ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 'warning');
            if (confirm('ì¿ í°ì´ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¿ í°ì„ í•´ì œí•˜ê³  í• ì¸ì½”ë“œë¥¼ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                removeActiveDiscount();
            } else {
                $('#discountCode').val('');
                return;
            }
        }

        // ì…ë ¥ê°’ ê²€ì¦
        if (!code || code.trim().length === 0) {
            showUserMessage('í• ì¸ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        // í• ì¸ì½”ë“œ ê¸¸ì´ ì œí•œ
        if (code.trim().length > 20) {
            showUserMessage('í• ì¸ì½”ë“œëŠ” 20ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        // ë²„íŠ¼ ë¡œë”© ìƒíƒœë¡œ ë³€ê²½
        setDiscountButtonLoading(true);

        // ë°±ì—”ë“œë¡œ í• ì¸ì½”ë“œ ê²€ì¦ ìš”ì²­
        $.ajax({
            url: '/order/discount/validate',              // â† ì—¬ê¸°ë¥¼ ë³€ê²½
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                discountId: code.trim(),
                orderAmount: originalAmount
            }),
            success: function(response) {
                setDiscountButtonLoading(false);

                if (response.success) {
                    // í• ì¸ì½”ë“œ ì ìš© ì„±ê³µ
                    const discountInfo = response.data;

                    activeDiscount = {
                        type: 'code',
                        code: discountInfo.discountId,
                        discountType: discountInfo.discountType,
                        value: discountInfo.discountValue,
                        amount: response.discountAmount,
                        name: discountInfo.discountDescription || discountInfo.discountId,
                        serverData: discountInfo
                    };

                    // ì¿ í° ì„¹ì…˜ ë¹„í™œì„±í™”
                    disableCouponSection();

                    updatePriceDisplay();
                    showAppliedDiscount();

                    const discountTypeText = discountInfo.discountType === 'per'
                        ? `${discountInfo.discountValue}% í• ì¸`
                        : `${response.discountAmount.toLocaleString()}ì› í• ì¸`;

                    showUserMessage(`í• ì¸ì½”ë“œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ${discountTypeText}!`, 'success');

                    // ì…ë ¥ í•„ë“œ ë¹„ìš°ê¸°
                    $('#discountCode').val('');

                    console.log('í• ì¸ì½”ë“œ ì ìš© ì„±ê³µ:', activeDiscount);
                } else {
                    // í• ì¸ì½”ë“œ ê²€ì¦ ì‹¤íŒ¨
                    showUserMessage(response.message || 'ìœ íš¨í•˜ì§€ ì•Šì€ í• ì¸ì½”ë“œì…ë‹ˆë‹¤.', 'error');
                    $('#discountCode').focus();
                }
            },
            error: function(xhr, status, error) {
                setDiscountButtonLoading(false);

                let errorMessage = 'í• ì¸ì½”ë“œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';

                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage = xhr.responseJSON.message;
                } else if (xhr.status === 404) {
                    errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ í• ì¸ì½”ë“œì…ë‹ˆë‹¤.';
                } else if (xhr.status === 400) {
                    errorMessage = 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤. í• ì¸ì½”ë“œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (xhr.status === 500) {
                    errorMessage = 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }

                console.error('í• ì¸ì½”ë“œ ê²€ì¦ ì˜¤ë¥˜:', {
                    status: xhr.status,
                    response: xhr.responseText,
                    error: error
                });

                showUserMessage(errorMessage, 'error');
                $('#discountCode').focus();
            }
        });
    }

    // í• ì¸ì½”ë“œ ë²„íŠ¼ ë¡œë”© ìƒíƒœ ê´€ë¦¬
    function setDiscountButtonLoading(isLoading) {
        const $button = $('#applyDiscountCode');
        const $input = $('#discountCode');

        if (isLoading) {
            $button.addClass('loading').prop('disabled', true);
            $input.prop('disabled', true);
        } else {
            $button.removeClass('loading').prop('disabled', false);
            $input.prop('disabled', false);
        }
    }

    // ì¿ í° ì ìš© (ë‹¨ë… ì‚¬ìš©)
    function applyCoupon(selectedOption) {
        if ($('#couponSelect').prop('disabled')) {
            showUserMessage('ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
            return;
        }

        if (selectedOption.val() === '' || selectedOption.prop('disabled')) {
            removeActiveDiscount();
            return;
        }

        // í• ì¸ì½”ë“œê°€ ì´ë¯¸ ì ìš©ëœ ê²½ìš° ê²½ê³ 
        if (activeDiscount && activeDiscount.type === 'code') {
            showUserMessage('í• ì¸ì½”ë“œê°€ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í• ì¸ì½”ë“œë¥¼ í•´ì œí•˜ê³  ì¿ í°ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 'warning');
            if (confirm('í• ì¸ì½”ë“œê°€ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í• ì¸ì½”ë“œë¥¼ í•´ì œí•˜ê³  ì¿ í°ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                removeActiveDiscount();
            } else {
                $('#couponSelect').val('');
                return;
            }
        }

        const couponCode = selectedOption.val();
        const discountType = selectedOption.data('type');
        const discountValue = selectedOption.data('value');
        const minAmount = selectedOption.data('min-amount');

        // ìµœì†Œ ì£¼ë¬¸ê¸ˆì•¡ í™•ì¸
        if (originalAmount < minAmount) {
            showUserMessage(`ì´ ì¿ í°ì€ ${minAmount.toLocaleString()}ì› ì´ìƒ ì£¼ë¬¸ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.`, 'error');
            $('#couponSelect').val('');
            return;
        }

        // í• ì¸ ê¸ˆì•¡ ê³„ì‚°
        let discountAmount = 0;
        if (discountType === 'per') {
            discountAmount = Math.floor(originalAmount * discountValue / 100);
        } else if (discountType === 'amount') {
            discountAmount = discountValue;
        } else {
            discountAmount = discountValue;
            console.warn('ì•Œ ìˆ˜ ì—†ëŠ” í• ì¸ íƒ€ì…:', discountType, '- ê³ ì • ê¸ˆì•¡ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.');
        }

        // ì¿ í° ì ìš©
        activeDiscount = {
            type: 'coupon',
            code: couponCode,
            discountType: discountType,
            value: discountValue,
            amount: discountAmount,
            name: selectedOption.text()
        };

        // í• ì¸ì½”ë“œ ì„¹ì…˜ ë¹„í™œì„±í™”
        disableDiscountCodeSection();

        updatePriceDisplay();
        updateCouponInfo(selectedOption.text());

        const discountTypeText = discountType === 'per' ? `${discountValue}% í• ì¸` : `${discountAmount.toLocaleString()}ì› í• ì¸`;
        showUserMessage(`ì¿ í°ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ${discountTypeText}!`, 'success');
    }

    // í™œì„±í™”ëœ í• ì¸ ì œê±°
    function removeActiveDiscount() {
        if (!activeDiscount) return;

        const wasCode = activeDiscount.type === 'code';

        activeDiscount = null;
        updatePriceDisplay();

        if (wasCode) {
            hideAppliedDiscount();
            enableCouponSection();
            showUserMessage('í• ì¸ì½”ë“œê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        } else {
            $('#couponSelect').val('');
            $('#couponInfo').removeClass('active').html('<i class="fas fa-info-circle"></i><span>ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì„ ì„ íƒí•˜ë©´ í• ì¸ì´ ì ìš©ë©ë‹ˆë‹¤</span>');
            enableDiscountCodeSection();
            showUserMessage('ì¿ í°ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        console.log('í• ì¸ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ê°€ê²©ì´ ì›ë˜ëŒ€ë¡œ ë³µì›ë©ë‹ˆë‹¤.');
    }

    // ê°€ê²© í‘œì‹œ ì—…ë°ì´íŠ¸ (ë‹¨ì¼ í• ì¸ë§Œ í‘œì‹œ)
    function updatePriceDisplay() {
        if (activeDiscount) {
            $('#discountRow').show();
            $('#discountLabel').text(activeDiscount.type === 'coupon' ? 'ì¿ í° í• ì¸' : 'í• ì¸ì½”ë“œ');
            $('#discountAmount').text(`-â‚©${activeDiscount.amount.toLocaleString()}`);
        } else {
            $('#discountRow').hide();
        }

        // ìµœì¢… ê¸ˆì•¡ ê³„ì‚°
        const originalFinalAmount = paymentInfo.finalAmount || 0;
        const totalDiscount = activeDiscount ? activeDiscount.amount : 0;
        currentTotalAmount = Math.max(0, originalFinalAmount - totalDiscount);

        // ìµœì¢… ê¸ˆì•¡ í‘œì‹œ ì—…ë°ì´íŠ¸
        $('#finalAmount').text(`â‚©${currentTotalAmount.toLocaleString()}`);
        $('#paymentButtonText').text(`â‚©${currentTotalAmount.toLocaleString()} ê²°ì œí•˜ê¸°`);
    }

    // ì¿ í° ì •ë³´ ì—…ë°ì´íŠ¸
    function updateCouponInfo(couponName) {
        $('#couponInfo').addClass('active').html(`<i class="fas fa-check-circle"></i><span>${couponName}ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤</span>`);
    }

    // ì ìš©ëœ í• ì¸ í‘œì‹œ
    function showAppliedDiscount() {
        const discountText = `${activeDiscount.name} (${activeDiscount.amount.toLocaleString()}ì› í• ì¸)`;
        $('#discountText').text(discountText);
        $('#appliedDiscount').show();
    }

    // ì ìš©ëœ í• ì¸ ìˆ¨ê¹€
    function hideAppliedDiscount() {
        $('#appliedDiscount').hide();
    }

    // ì¿ í° ì„¹ì…˜ ë¹„í™œì„±í™”
    function disableCouponSection() {
        $('#couponSelect').prop('disabled', true).addClass('disabled-coupon');
        $('.coupon-info').first().html('<i class="fas fa-info-circle"></i><span style="color: #999;">í• ì¸ì½”ë“œê°€ ì ìš©ëœ ìƒíƒœì—ì„œëŠ” ì¿ í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>');
    }

    // ì¿ í° ì„¹ì…˜ í™œì„±í™”
    function enableCouponSection() {
        const hasValidCoupons = $('#couponSelect option[value!=""]').length > 0;

        if (hasValidCoupons) {
            $('#couponSelect').prop('disabled', false).removeClass('disabled-coupon');
            $('.coupon-info').first().html('<i class="fas fa-info-circle"></i><span>ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì„ ì„ íƒí•˜ë©´ í• ì¸ì´ ì ìš©ë©ë‹ˆë‹¤</span>');
        }
    }

    // í• ì¸ì½”ë“œ ì„¹ì…˜ ë¹„í™œì„±í™”
    function disableDiscountCodeSection() {
        $('#discountCode').prop('disabled', true).addClass('disabled-input');
        $('#applyDiscountCode').prop('disabled', true).addClass('disabled-button');
        $('.coupon-info').last().html('<i class="fas fa-gift"></i><span style="color: #999;">ì¿ í°ì´ ì ìš©ëœ ìƒíƒœì—ì„œëŠ” í• ì¸ì½”ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>');
    }

    // í• ì¸ì½”ë“œ ì„¹ì…˜ í™œì„±í™”
    function enableDiscountCodeSection() {
        $('#discountCode').prop('disabled', false).removeClass('disabled-input');
        $('#applyDiscountCode').prop('disabled', false).removeClass('disabled-button');
        $('.coupon-info').last().html('<i class="fas fa-gift"></i><span>í• ì¸ì½”ë“œëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤</span>');
    }

    // í• ì¸ ì œê±° í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ)
    function removeDiscount() {
        removeActiveDiscount();
    }

    // ì£¼ì†Œ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€ ê´€ë¦¬
    function updateAddressFields() {
        const isSameInfo = $('#same-info').is(':checked');
        const addressFields = $('#addressFields');

        if (isSameInfo) {
            // íšŒì› ì •ë³´ê°€ ìˆëŠ” ê²½ìš° ì£¼ì†Œ í•„ë“œ ìë™ ì±„ì›€
            /*[# th:if="${member != null}" #]*/
            $('#receiverZip').val(/*[[${member?.memberZip}]]*/ '');
            $('#receiverAddr').val(/*[[${member?.memberAddr}]]*/ '');
            /*[/]*/

            // ì£¼ì†Œ í•„ë“œ ìˆ¨ê¹€
            addressFields.addClass('hidden');

            // ì£¼ì†Œ ê´€ë ¨ ìœ íš¨ì„± ê²€ì‚¬ ë¬´ì‹œ
            validationState.receiverAddr = true;
        } else {
            // ì£¼ì†Œ í•„ë“œ í‘œì‹œ
            addressFields.removeClass('hidden');

            // ì£¼ì†Œ ìœ íš¨ì„± ê²€ì‚¬ ë‹¤ì‹œ ì ìš©
            validateField('receiverAddr');
        }

        updatePaymentButton();
    }

    function validateField(fieldId) {
        const field = $('#' + fieldId);
        const value = field.val().trim();
        let isValid = false;
        let errorMessage = '';

        switch (fieldId) {
            case 'ordererName':
            case 'receiverName':
                isValid = value.length >= 2;
                errorMessage = isValid ? '' : 'ì´ë¦„ì„ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                break;

            case 'ordererPhone':
            case 'receiverPhone':
                isValid = validatePhone(value);
                errorMessage = isValid ? '' : 'ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 010-1234-5678)';
                break;

            case 'ordererEmail':
                isValid = validateEmail(value);
                errorMessage = isValid ? '' : 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                break;

            case 'receiverAddr':
                if ($('#same-info').is(':checked')) {
                    isValid = true;
                } else {
                    const zip = $('#receiverZip').val().trim();
                    const addr = $('#receiverAddr').val().trim();
                    const addrDetail = $('#receiverAddrDetail').val().trim();
                    isValid = zip.length > 0 && addr.length > 0 && addrDetail.length > 0;
                    errorMessage = isValid ? '' : 'ì£¼ì†Œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                }
                break;
        }

        validationState[fieldId] = isValid;

        if (isValid) {
            clearFieldError(fieldId);
        } else if (value.length > 0) {
            showFieldError(fieldId, errorMessage);
        } else {
            clearFieldError(fieldId);
        }

        updatePaymentButton();
        return isValid;
    }

    function validateAgreements() {
        validationState.agreeTerms = $('#agree-terms').is(':checked');
        validationState.agreePrivacy = $('#agree-privacy').is(':checked');
        validationState.agreeAdult = $('#agree-adult').is(':checked');
        updatePaymentButton();
    }

    function validateAllFields() {
        validateField('ordererName');
        validateField('ordererPhone');
        validateField('ordererEmail');
        validateField('receiverName');
        validateField('receiverPhone');
        validateField('receiverAddr');
        validateAgreements();
    }

    function showFieldError(fieldId, message) {
        const field = $('#' + fieldId);
        const errorElement = $('#' + fieldId + '-error');

        field.addClass('error');
        errorElement.text(message).show();
    }

    function clearFieldError(fieldId) {
        const field = $('#' + fieldId);
        const errorElement = $('#' + fieldId + '-error');

        field.removeClass('error');
        errorElement.hide();
    }

    function isFormValid() {
        return Object.values(validationState).every(isValid => isValid);
    }

    function updatePaymentButton() {
        const isValid = isFormValid();
        $('#paymentButton').prop('disabled', !isValid);

        if (isValid) {
            $('#paymentButton').removeClass('disabled');
        } else {
            $('#paymentButton').addClass('disabled');
        }
    }

    function processPayment() {
        if (!isFormValid()) {
            showUserMessage('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        isPaymentProcessing = true;

        const paymentData = {
            ordererName: $('#ordererName').val(),
            ordererPhone: $('#ordererPhone').val(),
            ordererEmail: $('#ordererEmail').val(),
            receiverName: $('#receiverName').val(),
            receiverPhone: $('#receiverPhone').val(),
            receiverZip: $('#receiverZip').val(),
            receiverAddr: $('#receiverAddr').val(),
            receiverAddrDetail: $('#same-info').is(':checked') ? '' : $('#receiverAddrDetail').val(),
            deliveryRequest: $('#deliveryRequest').val(),
            paymentMethod: $('input[name="payment"]:checked').val(),
            totalAmount: originalAmount,
            discountAmount: paymentInfo.discountAmount || 0,
            deliveryFee: paymentInfo.deliveryFee || 0,
            appliedDiscount: activeDiscount,
            finalAmount: currentTotalAmount,
            cartCodes: cartCodes,
            agreeTerms: $('#agree-terms').is(':checked'),
            agreePrivacy: $('#agree-privacy').is(':checked'),
            agreeMarketing: $('#agree-marketing').is(':checked'),
            adultVerified: true
        };

        setPaymentButtonLoading(true);

        $.ajax({
            url: '/order/payment/prepare',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(paymentData),
            success: function(response) {
                if (response.success) {
                    requestPayment(response.orderId, paymentData);
                } else {
                    showUserMessage('ê²°ì œ ì¤€ë¹„ ì‹¤íŒ¨: ' + response.message, 'error');
                    forceResetPaymentButton();
                    isPaymentProcessing = false;
                }
            },
            error: function(xhr, status, error) {
                console.error('ê²°ì œ ì¤€ë¹„ ì˜¤ë¥˜:', xhr.responseText);
                showUserMessage('ê²°ì œ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                forceResetPaymentButton();
                isPaymentProcessing = false;
            }
        });
    }

    function setPaymentButtonLoading(isLoading) {
        const $button = $('#paymentButton');

        if (isLoading) {
            $button.prop('disabled', true)
                .addClass('processing')
                .removeClass('disabled')
                .css({
                    'background': '#6c757d',
                    'cursor': 'not-allowed',
                    'transform': 'none',
                    'box-shadow': 'none',
                    'color': 'white'
                })
                .html('<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>ê²°ì œ ì²˜ë¦¬ ì¤‘...');
        } else {
            $button.prop('disabled', false)
                .removeClass('processing')
                .css({
                    'background': 'linear-gradient(135deg, #EE386D 0%, #d63060 100%)',
                    'cursor': 'pointer',
                    'transform': 'none',
                    'box-shadow': '0 4px 12px rgba(238, 56, 109, 0.3)',
                    'color': 'white'
                });

            $('#paymentButtonText').text(`â‚©${currentTotalAmount.toLocaleString()} ê²°ì œí•˜ê¸°`);
        }
    }

    function requestPayment(orderId, paymentData) {
        let productName = "í™€ë¦¬ë°¤ ìƒí’ˆ";
        if (cartItems && cartItems.length > 0) {
            if (cartItems.length === 1) {
                productName = cartItems[0].productDto.productName;
            } else {
                productName = cartItems[0].productDto.productName + " ì™¸ " + (cartItems.length - 1) + "ê±´";
            }
        }

        const paymentRequest = {
            pg: "html5_inicis",
            pay_method: paymentData.paymentMethod,
            merchant_uid: orderId,
            name: productName,
            amount: currentTotalAmount,
            buyer_email: paymentData.ordererEmail,
            buyer_name: paymentData.ordererName,
            buyer_tel: paymentData.ordererPhone,
            buyer_addr: paymentData.receiverAddr + ' ' + (paymentData.receiverAddrDetail || ''),
            buyer_postcode: paymentData.receiverZip,
            m_redirect_url: window.location.origin + "/order/payment/mobile-callback",
            custom_data: {
                adult_verified: true,
                product_type: "adult_products",
                cart_codes: cartCodes,
                applied_discount: activeDiscount
            }
        };

        IMP.request_pay(paymentRequest, function(response) {
            isPaymentProcessing = false;

            if (response.success) {
                $.ajax({
                    url: '/order/payment/complete',
                    method: 'POST',
                    data: {
                        imp_uid: response.imp_uid,
                        merchant_uid: response.merchant_uid
                    },
                    success: function(serverResponse) {
                        if (serverResponse.success) {
                            window.location.href = '/order/payment/success?orderId=' + orderId;
                        } else {
                            alert('ê²°ì œ ê²€ì¦ ì‹¤íŒ¨: ' + serverResponse.message);
                            window.location.href = '/order/payment/fail?orderId=' + orderId + '&error_msg=' + encodeURIComponent(serverResponse.message);
                        }
                    },
                    error: function() {
                        alert('ê²°ì œ ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        window.location.href = '/order/payment/fail?orderId=' + orderId + '&error_msg=' + encodeURIComponent('ê²°ì œ ê²€ì¦ ì˜¤ë¥˜');
                    }
                });
            } else {
                const errorMsg = response.error_msg || 'ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.';

                if (response.error_msg && response.error_msg.includes('ì·¨ì†Œ')) {
                    showUserMessage('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                    forceResetPaymentButton();
                } else {
                    showUserMessage('ê²°ì œ ì‹¤íŒ¨: ' + errorMsg, 'error');

                    $.ajax({
                        url: '/order/payment/fail',
                        method: 'POST',
                        data: {
                            merchant_uid: orderId,
                            error_msg: errorMsg
                        },
                        complete: function() {
                            forceResetPaymentButton();
                        }
                    });
                }
            }
        });
    }

    function showUserMessage(message, type) {
        $('.user-message').remove();

        const messageClass = type === 'error' ? 'error-message' : (type === 'success' ? 'success-message' : 'info-message');
        const iconClass = type === 'error' ? 'fas fa-exclamation-circle' : (type === 'success' ? 'fas fa-check-circle' : 'fas fa-info-circle');
        const bgColor = type === 'error' ? '#fff2f2' : (type === 'success' ? '#f0f9ff' : '#f0f9ff');
        const borderColor = type === 'error' ? '#ffcccc' : (type === 'success' ? '#b3e5fc' : '#b3e5fc');
        const textColor = type === 'error' ? '#d63060' : (type === 'success' ? '#0277bd' : '#0277bd');

        const messageHtml = `
            <div class="user-message ${messageClass}" style="
                display: flex;
                align-items: center;
                gap: 8px;
                background: ${bgColor};
                border: 1px solid ${borderColor};
                color: ${textColor};
                padding: 16px;
                border-radius: 12px;
                margin-bottom: 20px;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                animation: slideDown 0.3s ease-out;
            ">
                <i class="${iconClass}"></i>
                <span>${message}</span>
                <button onclick="$(this).closest('.user-message').fadeOut()" style="
                    margin-left: auto;
                    background: none;
                    border: none;
                    color: ${textColor};
                    cursor: pointer;
                    font-size: 16px;
                    padding: 0;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">Ã—</button>
            </div>
        `;

        $('.page-title').after(messageHtml);

        setTimeout(() => {
            $('.user-message').fadeOut();
        }, 5000);
    }

    function forceResetPaymentButton() {
        console.log('forceResetPaymentButton í•¨ìˆ˜ í˜¸ì¶œë¨');

        const $button = $('#paymentButton');

        $button.removeClass('processing disabled force-active')
            .prop('disabled', false)
            .removeAttr('style')
            .off('click mouseenter mouseleave');

        $button.attr('style', `
            background: linear-gradient(135deg, #EE386D 0%, #d63060 100%) !important;
            color: white !important;
            cursor: pointer !important;
            transform: none !important;
            box-shadow: 0 4px 12px rgba(238, 56, 109, 0.3) !important;
            pointer-events: auto !important;
            border: none !important;
            width: 100% !important;
            padding: 18px !important;
            border-radius: 12px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            margin-top: 20px !important;
        `);

        $('#paymentButtonText').text(`â‚©${currentTotalAmount.toLocaleString()} ê²°ì œí•˜ê¸°`);

        $button.on('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            if (isFormValid()) {
                processPayment();
            } else {
                const firstErrorField = Object.keys(validationState).find(key => !validationState[key]);
                if (firstErrorField && firstErrorField !== 'agreeTerms' && firstErrorField !== 'agreePrivacy' && firstErrorField !== 'agreeAdult') {
                    $('#' + firstErrorField).focus();
                } else {
                    showUserMessage('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ê³  ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.', 'error');
                }
            }
        });

        $button.on({
            mouseenter: function() {
                if (!$(this).prop('disabled') && !$(this).hasClass('processing')) {
                    $(this).css({
                        'transform': 'translateY(-2px)',
                        'box-shadow': '0 6px 20px rgba(238, 56, 109, 0.4)'
                    });
                }
            },
            mouseleave: function() {
                if (!$(this).prop('disabled') && !$(this).hasClass('processing')) {
                    $(this).css({
                        'transform': 'none',
                        'box-shadow': '0 4px 12px rgba(238, 56, 109, 0.3)'
                    });
                }
            }
        });

        setTimeout(() => {
            validateAllFields();
        }, 50);

        console.log('ê²°ì œ ë²„íŠ¼ì´ ê°•ì œë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                let addr = '';
                let extraAddr = '';

                if (data.userSelectedType === 'R') {
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }

                if(data.userSelectedType === 'R'){
                    if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    addr += extraAddr;
                }

                $('#receiverZip').val(data.zonecode);
                $('#receiverAddr').val(addr);
                $('#receiverAddrDetail').focus();

                validateField('receiverAddr');
            }
        }).open();
    }

    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }

    function validatePhone(phone) {
        const cleanPhone = phone.replace(/[^0-9]/g, '');
        const re = /^01[0-9]{8,9}$/;
        return re.test(cleanPhone);
    }

    let isPaymentProcessing = false;

    window.addEventListener('beforeunload', function(e) {
        if (isPaymentProcessing) {
            e.preventDefault();
            e.returnValue = 'ê²°ì œê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?';
        }
    });

    $('#paymentButton').click(function() {
        if (isFormValid()) {
            isPaymentProcessing = true;
        }
    });

    // ê¸€ë¡œë²Œ í•¨ìˆ˜ ë…¸ì¶œ
    window.forceResetPaymentButton = forceResetPaymentButton;
    window.removeDiscount = removeDiscount;

    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ (ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
    window.testResetButton = function() {
        console.log('í…ŒìŠ¤íŠ¸: ë²„íŠ¼ ê°•ì œ ë³µì› ì‹¤í–‰');
        if (typeof window.forceResetPaymentButton === 'function') {
            window.forceResetPaymentButton();
            console.log('í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ë²„íŠ¼ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš”');
        } else {
            console.error('forceResetPaymentButton í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
    };

    window.testBackendDiscountCode = function(code = 'SAVE2024') {
        console.log('í…ŒìŠ¤íŠ¸: ë°±ì—”ë“œ í• ì¸ì½”ë“œ ì ìš©');
        $('#discountCode').val(code);
        $('#applyDiscountCode').click();
        console.log('í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ë°±ì—”ë“œë¡œ í• ì¸ì½”ë“œ ê²€ì¦ ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤');
    };

    window.testCouponSelect = function() {
        console.log('í…ŒìŠ¤íŠ¸: ì²« ë²ˆì§¸ ì¿ í° ì„ íƒ');
        const firstOption = $('#couponSelect option[value!=""]:first');
        if (firstOption.length > 0) {
            $('#couponSelect').val(firstOption.val()).trigger('change');
            console.log('í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ì²« ë²ˆì§¸ ì¿ í°ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤');
        } else {
            console.log('í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤');
        }
    };

    window.resetAllDiscounts = function() {
        console.log('í…ŒìŠ¤íŠ¸: ëª¨ë“  í• ì¸ ì´ˆê¸°í™”');
        removeActiveDiscount();
        $('#discountCode').val('');
        console.log('í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ëª¨ë“  í• ì¸ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
    };

    window.debugPayment = function() {
        console.log('=== ê²°ì œ ë””ë²„ê·¸ ì •ë³´ ===');
        console.log('Payment Info:', paymentInfo);
        console.log('Cart Codes:', cartCodes);
        console.log('Cart Items:', cartItems);
        console.log('Active Discount:', activeDiscount);
        console.log('Original Amount:', originalAmount.toLocaleString());
        console.log('Current Total Amount:', currentTotalAmount.toLocaleString());
        console.log('Validation State:', validationState);
        console.log('Form Valid:', isFormValid());
        console.log('Payment Processing:', isPaymentProcessing);

        console.log('--- ê°€ê²© ì„¸ë¶€ ì •ë³´ ---');
        console.log('ìƒí’ˆ ê¸ˆì•¡:', originalAmount.toLocaleString());
        console.log('ê¸°ë³¸ í• ì¸:', (paymentInfo.discountAmount || 0).toLocaleString());
        console.log('ë°°ì†¡ë¹„:', (paymentInfo.deliveryFee || 0).toLocaleString());
        console.log('ì„œë²„ ìµœì¢… ê¸ˆì•¡:', (paymentInfo.finalAmount || 0).toLocaleString());
        if (activeDiscount) {
            console.log('ì ìš©ëœ í• ì¸:', activeDiscount.type, '-', activeDiscount.amount.toLocaleString());
        }
        console.log('ìµœì¢… ê²°ì œ ê¸ˆì•¡:', currentTotalAmount.toLocaleString());
        console.log('=====================');
    };

    // ì´ˆê¸°í™” í™•ì¸
    $(document).ready(function() {
        console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - í• ì¸ì½”ë“œ ë°±ì—”ë“œ ê²€ì¦ ì‹œìŠ¤í…œ í™œì„±í™”ë¨');
        console.log('ì‚¬ìš© ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜:');
        console.log('- window.testBackendDiscountCode(): ë°±ì—”ë“œ í• ì¸ì½”ë“œ ê²€ì¦ í…ŒìŠ¤íŠ¸');
        console.log('- window.testCouponSelect(): ì¿ í° ì„ íƒ í…ŒìŠ¤íŠ¸');
        console.log('- window.resetAllDiscounts(): ëª¨ë“  í• ì¸ ì´ˆê¸°í™”');
        console.log('- window.debugPayment(): ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥');
        console.log('ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸: POST /api/discount/validate');
    });

    // í• ì¸ì½”ë“œ ì…ë ¥ ì‹œ ëŒ€ë¬¸ì ë³€í™˜
    document.getElementById('discountCode').addEventListener('input', function (e) {
        e.target.value = e.target.value.toUpperCase();
    });
</script>
</body>
</html>