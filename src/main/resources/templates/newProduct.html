<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <title>신상품 - 홀리밤</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" th:href="@{/css/header.css}"/>
  <link rel="stylesheet" th:href="@{/css/footer.css}"/>
  <script type="text/javascript" th:src="@{/js/header.js}"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }

    /* 홀리밤 픽 배너 */
    .hollybam-pick-banner {
      background: linear-gradient(135deg, #EE386D 0%, #FF6B9D 100%);
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hollybam-pick-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="3" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
    }

    .hollybam-pick-banner-content {
      position: relative;
      z-index: 1;
    }

    .hollybam-pick-banner h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .hollybam-pick-banner p {
      font-size: 1.2rem;
      opacity: 0.9;
      font-weight: 400;
    }

    /* 필터 섹션 */
    .filter-section {
      background: white;
      padding: 20px 0;
      border-bottom: 1px solid #eee;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .filter-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-label {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      white-space: nowrap;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      min-width: 120px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 16px;
      padding-right: 32px;
    }

    .results-info {
      font-size: 14px;
      color: #666;
      font-weight: 500;
    }

    .pick-highlight {
      color: #EE386D;
      font-weight: 700;
    }

    /* 콘텐츠 */
    .content {
      min-height: 800px;
      display: flex;
      justify-content: center;
      padding: 60px 20px 0;
    }

    .inner-box {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 1280px;
    }

    .section-title {
      margin-bottom: 32px;
      font-size: 26px;
      font-weight: 600;
      color: #1a1a1a;
      text-align: left;
      position: relative;
      padding-left: 0;
      letter-spacing: -0.4px;
      line-height: 1.3;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 0;
      width: 40px;
      height: 2px;
      background: #EE386D;
      border-radius: 1px;
    }

    /* main.html과 동일한 상품 카드 스타일 */
    .product-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      width: 100%;
    }

    .v4-product {
      position: relative;
      background: transparent;
      border: none;
      border-radius: 0;
      box-shadow: none;
      overflow: visible;
      transition: transform 0.3s ease;
      cursor: pointer;
    }

    .v4-product:hover {
      transform: translateY(-3px);
    }

    .card-product-widget {
      display: flex;
      flex-direction: column;
      text-decoration: none;
      color: inherit;
      height: 100%;
    }

    .card-product-top-text {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #EE386D;
      color: white;
      padding: 6px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 700;
      z-index: 2;
    }

    .card-product-img {
      position: relative;
      background: #f5f5f5;
      border-radius: 20px;
      overflow: hidden;
      aspect-ratio: 1;
      margin-bottom: 10px;
      flex-shrink: 0;
    }

    .card-product-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .v4-product:hover .card-product-img img {
      transform: scale(1.05);
    }

    .card-product-info {
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 140px;
    }

    .card-product-title {
      font-size: 14px;
      font-weight: 600;
      color: #333333;
      line-height: 1.4;
      margin-bottom: 5px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-product-price {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
      min-height: 24px;
    }

    .sale-perc {
      background: #EE386D;
      color: white;
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
    }

    .sale_price {
      font-size: 16px;
      font-weight: 700;
      color: #000000;
      letter-spacing: -0.3px;
    }

    .regular_price {
      font-size: 12px;
      color: #888888;
      text-decoration: line-through;
    }

    .card-product-description {
      font-size: 12px;
      color: #888888;
      line-height: 1.4;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* 배송 메시지 (메인 페이지와 동일한 디자인) */
    .delivery-message {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 6px 0;
      padding: 6px 10px;
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-left: 3px solid #28a745;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      color: #495057;
      transition: all 0.2s ease;
      min-height: 28px;
      box-sizing: border-box;
    }

    .delivery-message:hover {
      background: #e8f5e8;
      border-left-color: #20c997;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(40, 167, 69, 0.15);
    }

    .delivery-icon {
      font-size: 11px;
      color: #28a745;
      flex-shrink: 0;
    }

    .delivery-text {
      font-size: 11px;
      letter-spacing: -0.1px;
      white-space: nowrap;
      color: #495057;
      font-weight: 500;
    }

    /* 숨김 상태 */
    .delivery-message.hidden {
      display: none;
    }

    /* 대체 메시지 (1시 이후) - 더 차분한 색상 */
    .delivery-message.next-day {
      background: #f8f9fa;
      border-left-color: #6c757d;
      color: #6c757d;
    }

    .delivery-message.next-day:hover {
      background: #e9ecef;
      border-left-color: #495057;
    }

    .delivery-message.next-day .delivery-icon {
      color: #6c757d;
    }

    .delivery-message.next-day .delivery-text {
      color: #6c757d;
    }

    .product_review_container {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      color: #888888;
      font-weight: 600;
      margin-top: auto;
      min-height: 16px;
    }

    .heart-icon, .star-icon {
      width: 12px;
      height: 12px;
      fill: #EE386D;
    }

    .wishlist-wrap {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 2;
    }

    .wishlist-btn {
      background: rgba(255,255,255,0.9);
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .wishlist-btn:hover {
      background: #EE386D;
      color: white;
    }

    .heart-icon {
      width: 16px;
      height: 16px;
    }

    /* 품절 상품 스타일 */
    .v4-product.sold-out {
      opacity: 0.7;
    }

    .v4-product.sold-out:hover {
      transform: none;
    }

    .v4-product.sold-out .card-product-img img {
      filter: grayscale(50%);
    }

    .v4-product.sold-out:hover .card-product-img img {
      transform: none;
    }

    /* Sold Out 뱃지 */
    .sold-out-badge {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #e74c3c;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      z-index: 2;
      box-shadow: 0 2px 8px rgba(231, 76, 60, 0.4);
    }

    .sold-out .card-product-title,
    .sold-out .sale_price {
      color: #999;
    }

    .sold-out .card-product-description,
    .sold-out .product_review_container {
      color: #ccc;
    }

    /* 빈 상품 목록 스타일 */
    .empty-product-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      text-align: center;
      padding: 60px 20px;
    }

    .empty-icon {
      font-size: 4rem;
      color: #ddd;
      margin-bottom: 20px;
    }

    .empty-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #666;
      margin-bottom: 10px;
    }

    .empty-description {
      font-size: 1rem;
      color: #999;
      line-height: 1.6;
      max-width: 400px;
    }

    /* 반응형 디자인 */
    @media (max-width: 1200px) {
      .product-row {
        grid-template-columns: repeat(3, 1fr);
      }

      .delivery-message {
        font-size: 10px;
        padding: 5px 8px;
        margin: 5px 0;
        gap: 5px;
        min-height: 26px;
      }

      .delivery-icon {
        font-size: 10px;
      }

      .delivery-text {
        font-size: 10px;
      }
    }

    @media (max-width: 768px) {
      .product-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .hollybam-pick-banner h1 {
        font-size: 2rem;
      }

      .section-title {
        font-size: 22px;
        margin-bottom: 24px;
      }

      .filter-container {
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .delivery-message {
        font-size: 9px;
        padding: 4px 6px;
        margin: 4px 0;
        border-radius: 4px;
        gap: 4px;
        min-height: 24px;
      }

      .delivery-icon {
        font-size: 9px;
      }

      .delivery-text {
        font-size: 9px;
      }
    }

    @media (max-width: 480px) {
      .content {
        padding: 40px 15px 0;
      }

      .product-row {
        gap: 12px;
      }

      .hollybam-pick-banner {
        height: 220px;
      }

      .hollybam-pick-banner h1 {
        font-size: 1.8rem;
      }

      .hollybam-pick-banner p {
        font-size: 1rem;
      }

      .section-title {
        font-size: 20px;
        margin-bottom: 20px;
      }

      .card-product-info {
        min-height: 120px;
      }

      .card-product-title {
        font-size: 13px;
      }

      .sale_price {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
<!-- 고정 헤더 (기존 헤더 include) -->
<div th:replace="~{layout/header :: header}"></div>

<!-- 홀리밤 픽 배너 -->
<div class="hollybam-pick-banner">
  <div class="hollybam-pick-banner-content">
    <h1>홀리밤 신상품</h1>
    <p>새로 입고된 신상품</p>
  </div>
</div>

<!-- 메인 콘텐츠 -->
<div class="content">
  <div class="inner-box">
    <div class="section-title">홀리밤 신상품</div>

    <!-- 상품이 있을 때 -->
    <div th:if="${proList != null and !#lists.isEmpty(proList)}" class="product-row">
      <!-- 홀리밤 픽 상품 동적 렌더링 (main.html 베스트 상품과 동일) -->
      <article class="v4-product" th:each="product : ${proList}"
               th:classappend="${product.productQuantity == null or product.productQuantity == 0} ? 'sold-out' : ''">
        <a class="card-product-widget" th:href="@{'/product/' + ${product.productId}}">
          <div class="card-product-img">
            <!-- 품절 뱃지 -->
            <div th:if="${product.productQuantity == null or product.productQuantity == 0}" class="sold-out-badge">
              SOLD OUT
            </div>
            <!-- 상품 이미지 (WebP 지원) -->
            <img class="product-img"
                 th:src="${'https://hollybam-static-image.s3.ap-northeast-2.amazonaws.com/product/' + product.imageDtoList[0].imageUrl}"
                 th:data-hover="${product.imageDtoList[0].imageWebp != null ? 'https://hollybam-static-image.s3.ap-northeast-2.amazonaws.com/product/' + product.imageDtoList[0].imageWebp : 'blob'}"
                 th:alt="${product.productName}" />
          </div>
          <div class="card-product-info">
            <!-- 상품명 -->
            <p class="card-product-title" th:text="${product.productName}">상품 이름</p>

            <!-- 가격 정보 -->
            <div class="card-product-price">
              <!-- 할인율 (할인이 있을 때만 표시) -->
              <div th:if="${product.priceDtoList[0].priceOriginal > product.priceDtoList[0].priceSelling}"
                   class="sale-perc"
                   th:text="${product.priceDtoList[0].percentage} + '%'">
                30%
              </div>
              <!-- 판매가 -->
              <div class="sale_price" th:text="${#numbers.formatInteger(product.priceDtoList[0].priceSelling, 3, 'COMMA')} + '원'">45,900원</div>
              <!-- 정가 (할인이 있을 때만 표시) -->
              <div th:if="${product.priceDtoList[0].priceOriginal > product.priceDtoList[0].priceSelling}"
                   class="regular_price"
                   th:text="${#numbers.formatInteger(product.priceDtoList[0].priceOriginal, 3, 'COMMA')} + '원'">
                70,000원
              </div>
            </div>

            <!-- 상품 설명 -->
            <p class="card-product-description" th:text="${product.productDescription}">상품 설명</p>

            <!-- 배송 메시지 (품절이 아닐 때만 표시) -->
            <div class="delivery-message" th:unless="${product.productQuantity == null or product.productQuantity == 0}">
              <i class="fas fa-shipping-fast delivery-icon"></i>
              <span class="delivery-text">1시 이전 주문 시 당일발송</span>
            </div>

            <!-- 좋아요 및 리뷰 정보 -->
            <div class="product_review_container">
              <svg class="heart-icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
              <span th:text="${product.wishCount ?: 0}">0</span>
              <svg class="star-icon" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
              <span th:text="${product.reviewAvg} + ' (' + ${product.reviewCount} + ')'">0.0 (0)</span>
            </div>
          </div>
        </a>
        <!-- 위시리스트 버튼 -->
        <div class="wishlist-wrap">
          <button class="wishlist-btn"
                  th:data-product-code="${product.productCode}"
                  title="위시리스트에 추가">
            <i class="far fa-heart heart-icon"></i>
          </button>
        </div>
      </article>
    </div>

    <!-- 상품이 없을 때 -->
    <div th:if="${proList == null or #lists.isEmpty(proList)}" class="empty-product-container">
      <div class="empty-icon">
        <i class="fas fa-box-open"></i>
      </div>
      <div class="empty-title">아직 등록된 상품이 없습니다</div>
      <div class="empty-description">
        운영자가 엄선한 추천 상품이 곧 업데이트될 예정입니다.<br>
        조금만 기다려 주세요!
      </div>
    </div>
  </div>
</div>

<!-- 푸터 -->
<div th:replace="~{layout/footer :: footer}"></div>

<script>
  // 현재 시간에 따른 배송 메시지 변경 (메인 페이지와 동일)
  document.addEventListener('DOMContentLoaded', function() {
    updateDeliveryMessages();
    setInterval(updateDeliveryMessages, 60000);
  });

  function updateDeliveryMessages() {
    const now = new Date();
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    const currentTimeInMinutes = currentHour * 60 + currentMinute;

    // 시간대별 설정 (메인 페이지와 동일)
    const SAME_DAY_START = 9 * 60;      // 오전 9시
    const SAME_DAY_END = 13 * 60;       // 오후 1시
    const NEXT_DAY_END = 18 * 60;       // 오후 6시

    const deliveryMessages = document.querySelectorAll('.delivery-message');

    deliveryMessages.forEach(function(message) {
      const icon = message.querySelector('.delivery-icon');
      const text = message.querySelector('.delivery-text');

      // 기본 클래스 제거
      message.classList.remove('hidden', 'next-day');

      if (currentTimeInMinutes >= SAME_DAY_START && currentTimeInMinutes < SAME_DAY_END) {
        // 오전 9시 ~ 오후 1시: 당일배송 메시지
        message.style.display = 'flex';
        message.classList.remove('next-day');
        icon.classList.remove('fa-clock');
        icon.classList.add('fa-shipping-fast');
        text.textContent = '1시 이전 주문 시 당일발송';

      } else if (currentTimeInMinutes >= SAME_DAY_END && currentTimeInMinutes < NEXT_DAY_END) {
        // 오후 1시 ~ 오후 6시: 내일 출고 메시지
        message.style.display = 'flex';
        message.classList.add('next-day');
        icon.classList.remove('fa-shipping-fast');
        icon.classList.add('fa-clock');
        text.textContent = '오후 1시 이전 주문건 당일 발송';

      } else {
        // 오후 6시 ~ 오전 9시: 숨김 처리
        message.classList.add('hidden');
        message.style.display = 'none';
      }
    });
  }

  // 상품 이미지 호버 효과 (main.html과 동일)
  document.addEventListener("DOMContentLoaded", function () {
    const imgs = document.querySelectorAll(".product-img");

    // 상품이 없으면 실행하지 않음
    if (imgs.length === 0) return;

    imgs.forEach(img => {
      const originalSrc = img.getAttribute("src");
      const hoverSrc = img.getAttribute("data-hover");

      // hoverSrc가 유효한 경우에만 이벤트 리스너 추가
      if (hoverSrc && hoverSrc !== 'blob' && hoverSrc.trim() !== '') {
        img.addEventListener("mouseenter", () => {
          img.setAttribute("src", hoverSrc);
        });

        img.addEventListener("mouseleave", () => {
          img.setAttribute("src", originalSrc);
        });
      }
    });
  });

  // 위시리스트 버튼 클릭 이벤트
  document.querySelectorAll('.wishlist-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();

      const heartIcon = this.querySelector('.heart-icon');
      const productCode = this.getAttribute('data-product-code');

      // 아이콘 토글 (임시 기능)
      if (heartIcon.classList.contains('far')) {
        heartIcon.classList.remove('far');
        heartIcon.classList.add('fas');
        this.style.background = '#EE386D';
        this.style.color = 'white';
      } else {
        heartIcon.classList.remove('fas');
        heartIcon.classList.add('far');
        this.style.background = 'rgba(255,255,255,0.9)';
        this.style.color = '';
      }

      console.log('위시리스트 버튼 클릭 - 상품코드:', productCode);
      // 백엔드 연동 시 AJAX 요청을 보낼 예정
    });
  });
</script>
</body>
</html>