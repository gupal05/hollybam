<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>상품 수정 - HOLLYBAM</title>

  <!-- 외부 라이브러리 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!-- 관리자 사이드바 CSS/JS -->
  <link rel="stylesheet" href="/css/adminSidebar.css">
  <script src="/js/adminSidebar.js"></script>

  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: #f8f9fa;
      color: #212529;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }

    /* 헤더 */
    .header {
      background: #fff;
      border-bottom: 1px solid #e9ecef;
      padding: 0 40px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .admin-info {
      color: #6c757d;
      font-size: 13px;
      font-weight: 300;
    }

    .logout-btn {
      background: #fff;
      color: #212529;
      border: 1px solid #212529;
      padding: 8px 16px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: #212529;
      color: #fff;
    }

    /* 컨테이너 */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px 120px 20px;
    }

    /* 페이지 타이틀 */
    .page-title {
      margin-bottom: 40px;
    }

    .page-title h2 {
      color: #212529;
      font-size: 28px;
      font-weight: 300;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .page-title p {
      color: #6c757d;
      font-size: 14px;
      font-weight: 300;
    }

    .page-nav {
      margin-bottom: 20px;
    }

    .page-nav a {
      color: #6c757d;
      text-decoration: none;
      font-size: 12px;
      margin-right: 10px;
    }

    .page-nav a:hover {
      color: #212529;
    }

    .page-nav .current {
      color: #212529;
      font-weight: 500;
    }

    /* 섹션 */
    .section {
      background: #fff;
      border: 1px solid #e9ecef;
      margin-bottom: 40px;
    }

    .section-header {
      padding: 30px 40px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title {
      color: #212529;
      font-size: 18px;
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    .section-description {
      color: #6c757d;
      font-size: 12px;
      margin-top: 5px;
    }

    .section-body {
      padding: 40px;
    }

    /* 폼 요소 */
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      align-items: end;
    }

    .form-group {
      flex: 1;
    }

    .form-group.half {
      flex: 0.5;
    }

    .form-group.quarter {
      flex: 0.25;
    }

    .form-group label {
      display: block;
      color: #212529;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-group .label-description {
      color: #6c757d;
      font-size: 11px;
      font-weight: 300;
      margin-top: 2px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 15px 20px;
      border: 1px solid #e9ecef;
      font-size: 14px;
      font-weight: 300;
      transition: border-color 0.3s ease;
      background: #fff;
      color: #212529;
      box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #212529;
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-group input[type="number"] {
      text-align: right;
    }

    .form-group input[readonly] {
      background-color: #f8f9fa;
      color: #6c757d;
    }

    /* 이미지 업로드 */
    .image-upload-area {
      border: 2px dashed #e9ecef;
      padding: 40px;
      text-align: center;
      transition: border-color 0.3s ease;
      cursor: pointer;
    }

    .image-upload-area:hover {
      border-color: #212529;
    }

    .image-preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }

    .image-preview {
      position: relative;
      width: 120px;
      height: 120px;
      border: 1px solid #e9ecef;
      overflow: hidden;
    }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-preview .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 20px;
      height: 20px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-preview .main-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: #28a745;
      color: #fff;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 2px;
    }

    /* 버튼 */
    .btn {
      background: #fff;
      color: #212529;
      border: 1px solid #dee2e6;
      padding: 12px 20px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      min-width: auto;
      justify-content: center;
      box-sizing: border-box;
    }

    .btn:hover {
      border-color: #212529;
    }

    .btn-primary {
      background: #212529;
      color: #fff;
      border-color: #212529;
    }

    .btn-primary:hover {
      background: #000;
    }

    .btn-success {
      background: #28a745;
      color: #fff;
      border-color: #28a745;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-danger {
      background: #dc3545;
      color: #fff;
      border-color: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-sm {
      padding: 8px 12px;
      font-size: 10px;
    }

    .btn-secondary {
      background: #fff;
      color: #212529;
      border: 1px solid #dee2e6;
    }

    .btn-secondary:hover {
      border-color: #212529;
    }

    /* 옵션 관리 */
    .option-container {
      border: 1px solid #e9ecef;
      margin-bottom: 20px;
      background: #f8f9fa;
    }

    .option-header {
      background: #fff;
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .option-title {
      font-weight: 500;
      color: #212529;
    }

    .option-body {
      padding: 20px;
    }

    .option-item {
      background: #fff;
      border: 1px solid #e9ecef;
      margin-bottom: 15px;
      padding: 20px;
      position: relative;
    }

    .option-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .option-item-title {
      font-weight: 500;
      color: #212529;
    }

    .option-remove-btn {
      width: 24px;
      height: 24px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 새 옵션 추가 관련 스타일 (상품 등록 페이지에서 가져온 스타일) */
    .new-option-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .new-option-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .new-option-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .new-option-item {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      padding: 30px;
      position: relative;
    }

    .new-option-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .new-option-item-title {
      color: #212529;
      font-size: 16px;
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    .new-option-remove-btn {
      background: #fff;
      color: #dc3545;
      border: 1px solid #dc3545;
      padding: 8px 12px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .new-option-remove-btn:hover {
      background: #dc3545;
      color: #fff;
    }

    .new-option-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .option-values-container {
      grid-column: 1 / -1;
      margin-top: 20px;
    }

    .option-values-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .option-values-title {
      color: #6c757d;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 400;
    }

    .add-value-btn {
      background: #fff;
      color: #212529;
      border: 1px solid #dee2e6;
      padding: 8px 16px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .add-value-btn:hover {
      border-color: #212529;
    }

    .option-values-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .option-value-item {
      display: grid;
      grid-template-columns: 1fr 100px 100px 100px auto;
      gap: 15px;
      align-items: center;
      padding: 15px;
      background: #fff;
      border: 1px solid #dee2e6;
    }

    .option-value-input {
      padding: 12px;
      border: 1px solid #dee2e6;
      background: #fff;
      color: #212529;
      font-size: 13px;
      font-weight: 300;
      transition: all 0.3s ease;
    }

    .option-value-input:focus {
      outline: none;
      border-color: #212529;
    }

    .remove-value-btn {
      background: #fff;
      color: #dc3545;
      border: 1px solid #dc3545;
      padding: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .remove-value-btn:hover {
      background: #dc3545;
      color: #fff;
    }

    /* 통합 원가 관리 관련 스타일 */
    .option-cost-management {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .uniform-cost-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .uniform-cost-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .uniform-cost-label {
      color: #212529;
      font-size: 14px;
      font-weight: 400;
      cursor: pointer;
      user-select: none;
    }

    .uniform-cost-input-group {
      display: none;
      margin-top: 15px;
    }

    .uniform-cost-input-group.active {
      display: block;
    }

    .uniform-cost-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .uniform-cost-input {
      width: 200px;
      padding: 12px;
      border: 1px solid #dee2e6;
      background: #fff;
      color: #212529;
      font-size: 14px;
      font-weight: 300;
      transition: all 0.3s ease;
    }

    .uniform-cost-input:focus {
      outline: none;
      border-color: #212529;
    }

    .uniform-cost-apply-btn {
      background: #212529;
      color: #fff;
      border: 1px solid #212529;
      padding: 12px 20px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .uniform-cost-apply-btn:hover {
      background: #000;
    }

    /* 기존 옵션 수정 스타일 */
    .existing-option {
      background: #f0f7ff;
      border: 1px solid #b3d9ff;
      margin-bottom: 15px;
      padding: 30px;
      position: relative;
    }

    .existing-option-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #b3d9ff;
    }

    .existing-option-title {
      color: #0066cc;
      font-size: 16px;
      font-weight: 400;
      letter-spacing: 0.5px;
    }

    .existing-option-remove-btn {
      background: #fff;
      color: #dc3545;
      border: 1px solid #dc3545;
      padding: 8px 12px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .existing-option-remove-btn:hover {
      background: #dc3545;
      color: #fff;
    }

    .existing-option-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .existing-option-name {
      background: #fff !important;
      border: 1px solid #b3d9ff !important;
    }

    .existing-option-name:focus {
      border-color: #0066cc !important;
    }

    .no-options-message {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }

    .help-text {
      color: #6c757d;
      font-size: 12px;
      font-weight: 300;
    }

    /* 폼 라벨 스타일 통일 */
    .form-label {
      color: #6c757d;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 400;
      margin-bottom: 8px;
    }

    .required {
      color: #dc3545;
      margin-left: 4px;
    }

    .form-input {
      width: 100%;
      padding: 15px;
      border: 1px solid #dee2e6;
      background: #fff;
      color: #212529;
      font-size: 14px;
      font-weight: 300;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #212529;
    }

    /* 가격 입력 그룹 */
    .price-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .price-group input {
      flex: 1;
    }

    .price-group .currency {
      color: #6c757d;
      font-size: 14px;
      font-weight: 500;
    }

    /* 고정 액션 바 */
    .fixed-action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #e9ecef;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 50;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }

    .action-left {
      display: flex;
      gap: 15px;
    }

    .action-right {
      display: flex;
      gap: 15px;
    }

    /* 탭 스타일 */
    .tab-container {
      border-bottom: 1px solid #e9ecef;
      margin-bottom: 30px;
    }

    .tab-nav {
      display: flex;
      gap: 0;
    }

    .tab-nav button {
      background: none;
      border: none;
      padding: 15px 25px;
      color: #6c757d;
      font-size: 13px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .tab-nav button.active {
      color: #212529;
      border-bottom-color: #212529;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* 반응형 */
    @media (max-width: 1200px) {
      .form-row {
        flex-wrap: wrap;
      }

      .form-group {
        min-width: 250px;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 0 20px;
      }

      .container {
        padding: 20px 15px 120px 15px;
      }

      .section-header,
      .section-body {
        padding: 20px;
      }

      .form-row {
        flex-direction: column;
      }

      .fixed-action-bar {
        padding: 15px 20px;
        flex-direction: column;
        gap: 10px;
      }

      .action-left,
      .action-right {
        width: 100%;
        justify-content: center;
      }

      .option-value-item {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .new-option-header {
        flex-direction: column;
        align-items: stretch;
      }

      .uniform-cost-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }

      .uniform-cost-input {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<!-- 사이드바 레이아웃 포함 -->
<div th:replace="~{layout/adminSidebar :: sidebar}"></div>

<!-- 메인 컨텐츠 -->
<div class="main-content">
  <!-- 헤더 -->
  <header class="header">
    <div class="header-actions">
      <div class="admin-info">
        관리자님 환영합니다
      </div>
      <button class="logout-btn">
        Sign Out
      </button>
    </div>
  </header>

  <!-- 컨테이너 -->
  <div class="container">
    <!-- 페이지 네비게이션 -->
    <div class="page-nav">
      <a href="/admin/product/list">상품 목록</a>
      <span>›</span>
      <span class="current">상품 수정</span>
    </div>

    <!-- 페이지 타이틀 -->
    <div class="page-title">
      <h2>상품 수정</h2>
      <p>등록된 상품 정보를 수정할 수 있습니다</p>
    </div>

    <form id="productEditForm" enctype="multipart/form-data">
      <!-- 기본 정보 -->
      <div class="section">
        <div class="section-header">
          <div>
            <h3 class="section-title">기본 정보</h3>
            <div class="section-description">상품의 기본적인 정보를 설정합니다</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-row">
            <div class="form-group">
              <label>상품 코드</label>
              <input type="text" name="productCode" th:value="${product?.productCode}" readonly>
              <div class="label-description">시스템에서 자동 생성되는 고유 코드입니다</div>
            </div>
            <div class="form-group">
              <label>상품 ID</label>
              <input type="text" name="productId" th:value="${product?.productId}" placeholder="PRD-001" required>
              <div class="label-description">사용자가 설정할 수 있는 상품 식별자입니다</div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>상품명</label>
              <input type="text" name="productName" th:value="${product?.productName}" placeholder="상품명을 입력하세요" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>상품 설명</label>
              <textarea name="productDescription" placeholder="상품에 대한 상세한 설명을 입력하세요" th:text="${product?.productDescription}"></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group quarter">
              <label>재고 수량</label>
              <input type="number" name="productQuantity" id="productQuantity" th:value="${product?.productQuantity}" min="0" required>
            </div>
            <div class="form-group quarter">
              <label>상품 상태</label>
              <select name="productActive">
                <option value="1" th:selected="${product?.productActive == 1}">판매중</option>
                <option value="0" th:selected="${product?.productActive == 0}">판매중지</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- 상품 옵션 관리 -->
      <div class="section">
        <div class="section-header">
          <div>
            <h3 class="section-title">상품 옵션</h3>
            <div class="section-description">상품의 옵션을 설정합니다 (선택사항)</div>
          </div>
          <button type="button" class="btn btn-success" id="addNewOptionBtn">옵션 추가</button>
        </div>
        <div class="section-body">
          <!-- 기존 옵션 표시 영역 -->
          <div id="existingOptionsContainer">
            <!-- 기존 옵션이 있을 때 -->
            <div th:if="${options != null and !options.isEmpty()}">
              <div class="existing-option">
                <div class="existing-option-header">
                  <h4 class="existing-option-title">기존 옵션</h4>
                  <button type="button" class="existing-option-remove-btn">
                    삭제
                  </button>
                </div>
                <div class="existing-option-fields">
                  <div class="form-group">
                    <label class="form-label">
                      옵션명 <span class="required">*</span>
                    </label>
                    <input type="text" class="form-input existing-option-name" th:value="${optionName}" placeholder="예: 색상, 크기, 재질" required>
                  </div>
                </div>
                <div class="option-values-container">
                  <div class="option-values-header">
                    <span class="option-values-title">옵션값 설정</span>
                    <button type="button" class="add-value-btn">
                      값 추가
                    </button>
                  </div>
                  <div class="option-values-list"
                       th:each="value, iter : ${options}"
                       th:id="'existingOptionValues-' + ${value['optionCode']}">

                    <div class="option-value-item" th:data-value-id="${value['optionCode']}">
                      <input type="text" class="option-value-input option-value"
                             th:value="${value['optionValue']}" placeholder="옵션값 (예: 빨강, Large)">

                      <input type="number" class="option-value-input option-price"
                             th:value="${value['optionPrice']}" placeholder="추가금액" min="0">

                      <input type="number" class="option-value-input option-cost"
                             th:value="${value['optionPriceCost']}" placeholder="원가" min="0">

                      <input type="number" class="option-value-input option-quantity"
                             th:value="${value['optionQuantity']}" placeholder="재고" min="0"
                             onchange="updateTotalQuantity()">

                      <button type="button" class="remove-value-btn" onclick="removeExistingOptionValue(this)">
                        삭제
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 기존 옵션이 없을 때 -->
            <div th:if="${options == null or options.isEmpty()}" class="no-options-message">
              <p>현재 설정된 옵션이 없습니다.</p>
              <p style="font-size: 12px;">옵션이 필요한 상품의 경우 '옵션 추가' 버튼을 클릭하세요.</p>
            </div>
          </div>

          <!-- 새 옵션 추가 영역 -->
          <div id="newOptionsContainer" class="new-option-container" style="display: none;">
            <!-- 통합 원가 관리 -->
            <div class="option-cost-management" id="optionCostManagement" style="display: none;">
              <div class="uniform-cost-toggle">
                <input type="checkbox" class="uniform-cost-checkbox" id="uniformCostCheck">
                <label class="uniform-cost-label" for="uniformCostCheck">
                  모든 신규 옵션 원가 동일하게 설정
                </label>
              </div>

              <div class="uniform-cost-input-group" id="uniformCostInputGroup">
                <div class="form-group">
                  <label class="form-label">
                    통합 옵션 원가
                  </label>
                  <div class="uniform-cost-controls">
                    <div class="price-group">
                      <input type="number" class="uniform-cost-input" id="uniformCostInput" placeholder="0" min="0">
                      <span class="currency">₩</span>
                    </div>
                    <button type="button" class="uniform-cost-apply-btn" id="applyCostBtn">
                      모든 신규 옵션에 적용
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="new-option-header">
              <p class="help-text">새로운 옵션을 추가할 수 있습니다.</p>
            </div>

            <div id="newOptionList" class="new-option-list">
              <!-- 동적으로 새 옵션이 추가될 영역 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 가격 정보 -->
      <div class="section">
        <div class="section-header">
          <div>
            <h3 class="section-title">가격 정보</h3>
            <div class="section-description">상품의 가격 정보를 설정합니다</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-row">
            <div class="form-group">
              <label>원가</label>
              <div class="price-group">
                <input type="number" name="costPrice" th:value="${product?.priceCost}" min="0" placeholder="0">
                <span class="currency">₩</span>
              </div>
              <div class="label-description">상품의 실제 구매/제조 비용입니다</div>
            </div>
            <div class="form-group">
              <label>정가</label>
              <div class="price-group">
                <input type="number" name="originalPrice" th:value="${product?.priceOriginal}" min="0" placeholder="0">
                <span class="currency">₩</span>
              </div>
              <div class="label-description">상품의 정식 판매가격입니다</div>
            </div>
            <div class="form-group">
              <label>판매가</label>
              <div class="price-group">
                <input type="number" name="sellingPrice" th:value="${product?.priceSelling}" min="0" placeholder="0" required>
                <span class="currency">₩</span>
              </div>
              <div class="label-description">실제로 고객에게 판매되는 가격입니다</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 이미지 관리 -->
      <div class="section">
        <div class="section-header">
          <div>
            <h3 class="section-title">이미지 관리</h3>
            <div class="section-description">상품의 이미지를 관리합니다</div>
          </div>
        </div>
        <div class="section-body">
          <!-- 탭 네비게이션 -->
          <div class="tab-container">
            <div class="tab-nav">
              <button type="button" class="tab-btn active" data-tab="title">타이틀 이미지</button>
              <button type="button" class="tab-btn" data-tab="thumb">썸네일 이미지</button>
              <button type="button" class="tab-btn" data-tab="detail">상세 이미지</button>
            </div>
          </div>

          <!-- 타이틀 이미지 -->
          <div class="tab-content active" data-tab-content="title">
            <div class="form-group">
              <label>대표 이미지</label>
              <div class="image-upload-area">
                <div>
                  <p>클릭하거나 파일을 여기로 드래그하세요</p>
                  <p style="font-size: 12px; color: #6c757d;">JPG, PNG 파일만 업로드 가능 (최대 5MB)</p>
                </div>
                <input type="file" name="titleImage" accept="image/*" style="display: none;">
              </div>
              <div class="label-description">상품 목록에서 보여질 대표 이미지입니다</div>
              <div class="image-preview-container">
                <!-- 기존 타이틀 이미지가 있다면 표시 -->
                <div class="image-preview" th:if="${product?.titleImageUrl}">
                  <img th:src="${'https://hollybam-static-image.s3.ap-northeast-2.amazonaws.com/product/' + product.titleImageUrl}" alt="타이틀 이미지">
                  <button type="button" class="remove-btn">&times;</button>
                  <div class="main-badge">대표</div>
                </div>
              </div>
            </div>
          </div>

          <!-- 썸네일 이미지 -->
          <div class="tab-content" data-tab-content="thumb">
            <div class="form-group">
              <label>썸네일 이미지</label>
              <div class="image-upload-area">
                <div>
                  <p>클릭하거나 파일을 여기로 드래그하세요</p>
                  <p style="font-size: 12px; color: #6c757d;">여러 파일 선택 가능 (각각 최대 5MB)</p>
                </div>
                <input type="file" name="thumbnailImages" accept="image/*" multiple style="display: none;">
              </div>
              <div class="label-description">상품 상세 페이지에서 보여질 추가 이미지들입니다</div>
              <div class="image-preview-container">
                <!-- 기존 썸네일 이미지들이 있다면 표시 -->
                <div class="image-preview" th:each="image : ${thumbnails}">
                  <img th:src="${'https://hollybam-static-image.s3.ap-northeast-2.amazonaws.com/product/' + image.imageUrl}" alt="썸네일 이미지">
                  <button type="button" class="remove-btn">&times;</button>
                </div>
              </div>
            </div>
          </div>

          <!-- 상세 이미지 -->
          <div class="tab-content" data-tab-content="detail">
            <div class="form-group">
              <label>상세 설명 이미지</label>
              <div class="image-upload-area">
                <div>
                  <p>클릭하거나 파일을 여기로 드래그하세요</p>
                  <p style="font-size: 12px; color: #6c757d;">여러 파일 선택 가능 (각각 최대 10MB)</p>
                </div>
                <input type="file" name="detailImages" accept="image/*" multiple style="display: none;">
              </div>
              <div class="label-description">상품 상세 설명에 사용될 이미지들입니다</div>
              <div class="image-preview-container">
                <!-- 기존 상세 이미지들이 있다면 표시 -->
                <div class="image-preview" th:each="image : ${details}">
                  <img th:src="${'https://hollybam-static-image.s3.ap-northeast-2.amazonaws.com/product/' + image.imageUrl}" alt="썸네일 이미지">
                  <button type="button" class="remove-btn">&times;</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- 고정 액션 바 -->
  <div class="fixed-action-bar">
    <div class="action-left">
      <button type="button" class="btn">미리보기</button>
    </div>
    <div class="action-right">
      <a href="/admin/product/list" class="btn">취소</a>
      <button type="submit" form="productEditForm" class="btn btn-primary">상품 수정</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // 탭 기능
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', function () {
        const target = button.getAttribute('data-tab');

        // 탭 버튼 스타일 조정
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        // 탭 콘텐츠 표시 조정
        tabContents.forEach(content => {
          const contentTab = content.getAttribute('data-tab-content');
          if (contentTab === target) {
            content.classList.add('active');
          } else {
            content.classList.remove('active');
          }
        });
      });
    });

    // 옵션 관리 변수
    let newOptionCounter = 0;
    let hasNewOptions = false;

    // 원래 재고 수량 저장 (옵션 제거 시 복구용)
    let originalQuantity = $('#productQuantity').val();
    let isOptionMode = $('.existing-option').length > 0 || $('.new-option-item').length > 0;

    // 재고 수량 직접 수정 시에만 원래 값 업데이트 (옵션 모드가 아닐 때만)
    $('#productQuantity').on('input change', function() {
      if (!$(this).prop('readonly') && !isOptionMode) {
        originalQuantity = $(this).val();
      }
    });

    // 새 옵션 추가 전에 현재 재고값을 originalQuantity로 저장
    function saveCurrentQuantityAsOriginal() {
      if (!isOptionMode) {
        originalQuantity = $('#productQuantity').val();
      }
    }

    // 새 옵션 추가 버튼 클릭 이벤트
    $('#addNewOptionBtn').on('click', function() {
      const $newOptionsContainer = $('#newOptionsContainer');
      const $noOptionsMessage = $('.no-options-message');

      // 옵션 추가 전에 현재 재고값을 원래값으로 저장
      saveCurrentQuantityAsOriginal();

      // 새 옵션 컨테이너 표시
      $newOptionsContainer.show();
      // 옵션이 없다는 메시지 숨김
      $noOptionsMessage.hide();

      addNewOption();
    });

    // 페이지 로드 시 기존 옵션이 있으면 메시지 숨김
    if ($('.existing-option').length > 0) {
      $('.no-options-message').hide();
      // 기존 옵션이 있는 경우, 현재 재고값을 originalQuantity로 설정
      // (이미 옵션별 재고의 합계가 계산되어 있음)
      originalQuantity = $('#productQuantity').val();
    }

    // 재고 수량 관리 초기화
    updateQuantityMode();

    // 재고 관리 모드 업데이트
    function updateQuantityMode() {
      const hasOptionsNow = $('.existing-option').length > 0 || $('.new-option-item').length > 0;
      const $quantityInput = $('#productQuantity');

      if (hasOptionsNow) {
        // 옵션이 있는 경우: readonly 모드
        $quantityInput.prop('readonly', true).css('background', '#f8f9fa');
        isOptionMode = true;
        // 현재 총 재고 계산
        updateTotalQuantity();
      } else {
        // 옵션이 없는 경우: 수동 입력 모드로 복구
        $quantityInput.prop('readonly', false).css('background', '#fff');
        isOptionMode = false;
        // 원래 재고 수량으로 복구
        $quantityInput.val(originalQuantity);
      }
    }

    // 총 재고 수량 계산 및 업데이트
    window.updateTotalQuantity = function() {
      if (!$('#productQuantity').prop('readonly')) return;

      let totalQuantity = 0;

      // 기존 옵션 + 새 옵션 모두 포함해서 계산
      $('.option-quantity').each(function() {
        const quantity = parseInt($(this).val()) || 0;
        totalQuantity += quantity;
      });

      $('#productQuantity').val(totalQuantity);
    };

    // 새 옵션 추가 함수
    function addNewOption() {
      newOptionCounter++;
      const optionHtml = `
        <div class="new-option-item" data-option-index="${newOptionCounter}">
          <div class="new-option-item-header">
            <h4 class="new-option-item-title">새 옵션 ${newOptionCounter}</h4>
            <button type="button" class="new-option-remove-btn" onclick="removeNewOption(${newOptionCounter})">
              제거
            </button>
          </div>
          <div class="new-option-fields">
            <div class="form-group">
              <label class="form-label">
                옵션명 <span class="required">*</span>
              </label>
              <input type="text" class="form-input option-name" placeholder="예: 색상, 크기, 재질" required>
            </div>
          </div>
          <div class="option-values-container">
            <div class="option-values-header">
              <span class="option-values-title">옵션값 설정</span>
              <button type="button" class="add-value-btn" onclick="addNewOptionValue(${newOptionCounter})">
                값 추가
              </button>
            </div>
            <div class="option-values-list" id="newOptionValues-${newOptionCounter}">
              <!-- 옵션값들이 동적으로 추가될 영역 -->
            </div>
          </div>
        </div>
      `;

      $('#newOptionList').append(optionHtml);

      // 첫 번째 옵션값 자동 추가
      addNewOptionValue(newOptionCounter);

      // 재고 관리 모드 업데이트
      updateQuantityMode();

      // 옵션 원가 관리 표시
      updateOptionCostManagement();
    }

    // 새 옵션 제거 함수
    window.removeNewOption = function(optionIndex) {
      $(`.new-option-item[data-option-index="${optionIndex}"]`).remove();
      updateOptionCostManagement();
      updateQuantityMode();

      // 새 옵션이 모두 제거되었을 때
      if ($('.new-option-item').length === 0) {
        $('#newOptionsContainer').hide();
        // 기존 옵션도 없다면 메시지 다시 표시
        if ($('.existing-option').length === 0) {
          $('.no-options-message').show();
        }
      }
    };

    // 새 옵션값 추가 함수
    window.addNewOptionValue = function(optionIndex) {
      const uniformCost = $('#uniformCostCheck').is(':checked') ? $('#uniformCostInput').val() || '' : '';

      const valueHtml = `
        <div class="option-value-item">
          <input type="text" class="option-value-input option-value"
                 placeholder="옵션값 (예: 빨강, Large)">
          <input type="number" class="option-value-input option-price"
                 placeholder="추가금액" min="0">
          <input type="number" class="option-value-input option-cost"
                 placeholder="원가" min="0" value="${uniformCost}">
          <input type="number" class="option-value-input option-quantity"
                 placeholder="재고" min="0" onchange="updateTotalQuantity()">
          <button type="button" class="remove-value-btn" onclick="removeNewOptionValue(this)">
            제거
          </button>
        </div>
      `;

      $(`#newOptionValues-${optionIndex}`).append(valueHtml);
    };

    // 새 옵션값 제거 함수
    window.removeNewOptionValue = function(button) {
      $(button).closest('.option-value-item').remove();
      updateTotalQuantity();
    };

    // 옵션 원가 관리 표시/숨김 업데이트
    function updateOptionCostManagement() {
      const hasNewOptionsNow = $('.new-option-item').length > 0;
      const $optionCostManagement = $('#optionCostManagement');

      if (hasNewOptionsNow) {
        $optionCostManagement.show();
      } else {
        $optionCostManagement.hide();
      }

      hasNewOptions = hasNewOptionsNow;
    }

    // 통합 원가 체크박스 토글
    $('#uniformCostCheck').on('change', function() {
      const $inputGroup = $('#uniformCostInputGroup');

      if ($(this).is(':checked')) {
        $inputGroup.addClass('active');
      } else {
        $inputGroup.removeClass('active');
        $('#uniformCostInput').val('');
        // 체크 해제 시 모든 옵션 원가 필드를 수동 입력 가능하게 만들기
        $('.option-cost').prop('readonly', false).css('background', '#fff');
      }
    });

    // 통합 원가 적용 버튼 클릭
    $('#applyCostBtn').on('click', function() {
      const uniformCost = $('#uniformCostInput').val();

      if (!uniformCost || uniformCost <= 0) {
        alert('올바른 원가를 입력해주세요.');
        return;
      }

      // 모든 새 옵션의 원가 필드에 동일한 값 적용
      $('.option-cost').val(uniformCost);

      alert('모든 새 옵션에 원가가 적용되었습니다.');
    });

    // 통합 원가 입력창에서 엔터키 처리
    $('#uniformCostInput').on('keypress', function(e) {
      if (e.which === 13) {
        $('#applyCostBtn').click();
      }
    });

    // 기존 옵션 제거 함수
    window.removeExistingOption = function(optionCode) {
      if (confirm('이 옵션을 삭제하시겠습니까?')) {
        $(`.existing-option[data-option-id="${optionCode}"]`).remove();

        // 재고 관리 모드 업데이트
        updateQuantityMode();

        // 기존 옵션이 모두 제거되었고 새 옵션도 없다면 메시지 표시
        if ($('.existing-option').length === 0 && $('.new-option-item').length === 0) {
          $('.no-options-message').show();
        }
      }
    };

    // 기존 옵션에 옵션값 추가 함수
    window.addExistingOptionValue = function(optionCode) {
      const valueHtml = `
        <div class="option-value-item" data-value-id="new">
          <input type="text" class="option-value-input option-value"
                 placeholder="옵션값 (예: 빨강, Large)">
          <input type="number" class="option-value-input option-price"
                 placeholder="추가금액" min="0">
          <input type="number" class="option-value-input option-cost"
                 placeholder="원가" min="0">
          <input type="number" class="option-value-input option-quantity"
                 placeholder="재고" min="0" onchange="updateTotalQuantity()">
          <button type="button" class="remove-value-btn" onclick="removeExistingOptionValue(this)">
            삭제
          </button>
        </div>
      `;

      $(`#existingOptionValues-${optionCode}`).append(valueHtml);
    };

    // 기존 옵션값 제거 함수
    window.removeExistingOptionValue = function(button) {
      if (confirm('이 옵션값을 삭제하시겠습니까?')) {
        $(button).closest('.option-value-item').remove();
        updateTotalQuantity();
      }
    };

    // 기존 옵션 데이터 수집 함수
    window.collectExistingOptionData = function() {
      const options = [];

      $('.existing-option').each(function() {
        const $optionItem = $(this);
        const optionCode = $optionItem.data('option-id');
        const optionName = $optionItem.find('.existing-option-name').val().trim();

        if (optionName) {
          const optionValues = [];

          $optionItem.find('.option-value-item').each(function() {
            const $valueItem = $(this);
            const valueId = $valueItem.data('value-id');
            const value = $valueItem.find('.option-value').val().trim();
            const price = parseInt($valueItem.find('.option-price').val()) || 0;
            const cost = parseInt($valueItem.find('.option-cost').val()) || 0;
            const quantity = parseInt($valueItem.find('.option-quantity').val()) || 0;

            if (value) {
              optionValues.push({
                optionValueId: valueId === 'new' ? null : valueId,
                optionValue: value,
                optionPrice: price,
                optionCost: cost,
                optionQuantity: quantity,
                isNew: valueId === 'new'
              });
            }
          });

          if (optionValues.length > 0) {
            options.push({
              optionCode: optionCode,
              optionName: optionName,
              values: optionValues,
              isModified: true
            });
          }
        }
      });

      return options;
    };

    // 새 옵션 데이터 수집 함수 (폼 제출 시 사용)
    window.collectNewOptionData = function() {
      const options = [];

      $('.new-option-item').each(function() {
        const $optionItem = $(this);
        const optionName = $optionItem.find('.option-name').val().trim();

        if (optionName) {
          const optionValues = [];

          $optionItem.find('.option-value-item').each(function() {
            const $valueItem = $(this);
            const value = $valueItem.find('.option-value').val().trim();
            const price = parseInt($valueItem.find('.option-price').val()) || 0;
            const cost = parseInt($valueItem.find('.option-cost').val()) || 0;
            const quantity = parseInt($valueItem.find('.option-quantity').val()) || 0;

            if (value) {
              optionValues.push({
                optionValue: value,
                optionPrice: price,
                optionCost: cost,
                optionQuantity: quantity
              });
            }
          });

          if (optionValues.length > 0) {
            options.push({
              optionName: optionName,
              values: optionValues,
              isNew: true
            });
          }
        }
      });

      return options;
    };

    // 전체 옵션 데이터 수집 함수 (기존 + 새 옵션)
    window.collectAllOptionData = function() {
      const existingOptions = collectExistingOptionData();
      const newOptions = collectNewOptionData();

      return {
        existingOptions: existingOptions,
        newOptions: newOptions
      };
    };
  });
</script>
</body>
</html>